var main={spinner:'<span class="spinner-border spinner-border-sm" role="status"></span> Loading...',multiSelectSearch:"<input type='search' class='form-control form-control-sm' autocomplete='off' placeholder='Search'>",cookieConfig:{domain:"."+document.domain,path:"/"},init:function(){loadTooltip(),bsCustomFileInput.init(),$(document).on("change","input[type=checkbox]",(function(){var e=$($(this)[0]),t=e.data("tableid");t&&checkAll(e,t)})),void 0!==$.fn.DataTable&&$.extend(!0,$.fn.dataTable.defaults,{destroy:!0,stateSave:!0,responsive:!0,processing:!0,paging:!0,deferRender:!0,searchDelay:2e3,language:{decimal:"",emptyTable:"No data available in table",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",infoFiltered:"(filtered from _MAX_ total entries)",infoPostFix:"",thousands:",",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",processing:"Processing...",search:"Search:",zeroRecords:"No matching records found",aria:{sortAscending:": activate to sort column ascending",sortDescending:": activate to sort column descending"},paginate:{first:'<i class="fas fa-step-backward"></i>',last:'<i class="fas fa-step-forward"></i>',next:'<i class="fas fa-chevron-right"></i>',previous:'<i class="fas fa-chevron-left"></i>'}}}),$(".carousel").carousel({interval:5e3,pause:"hover"}),$(".sweet-overlay").click((function(){$(this).hide(),$(".sweet-alert").removeClass("showSweetAlert visible").addClass("hideSweetAlert")})),loadSelect2(),$(window).on("scroll",(function(){var e=$("#gotoTop");document.body.scrollTop>200||document.documentElement.scrollTop>200?e.fadeIn():e.fadeOut()})),$("#gotoTop").on("click",(function(){$("html,body").animate({scrollTop:0},"slow")})),ajaxPOST(adminURL+"ajax/public/",{action:"getLoadBalancerList"},(function(e){localStorage.setItem("lb",JSON.stringify(e.result))}),(function(e){localStorage.setItem("lb","[]")}));var e=Cookies.get("adm-type",main.cookieConfig),t=Cookies.get("adm-message",main.cookieConfig);void 0!==t&&showToast(t.trim(),e,(function(){Cookies.remove("adm-type",main.cookieConfig),Cookies.remove("adm-message",main.cookieConfig)}));var a=localStorage.getItem("collapseSites");a=null!==a?a.replace("true","show"):"hide",$("#collapseSites").collapse(a),$("#collapseSites").on("shown.bs.collapse",(function(){localStorage.setItem("collapseSites",!0)})).on("hidden.bs.collapse",(function(){localStorage.removeItem("collapseSites",!0)})),$("#txtSearchHost").on("blur keyup change",(function(){searchHost($(this).val().toLowerCase())})),$(".btn-shp").click((function(){var e=$(this).data("shp");void 0!==e&&("password"===$(e).attr("type")?($(e).attr("type","text"),$(this).find(".fas").removeClass("fa-eye").addClass("fa-eye-slash")):($(e).attr("type","password"),$(this).find(".fas").removeClass("fa-eye-slash").addClass("fa-eye")))})),$("#user").change((function(){$.ajax({url:adminURL+"ajax/public/",type:"POST",data:{action:"checkUsername",username:$(this).val()},success:function(e){ajaxValidation("#user","fail"!==e.status?"":e.message)},error:function(e){}})})),$("#email").change((function(){$.ajax({url:adminURL+"ajax/public/",type:"POST",data:{action:"checkEmail",email:$(this).val()},success:function(e){ajaxValidation("#email","fail"!==e.status?"":e.message)},error:function(e){}})})),$("#retype_password").change((function(){var e="#retype_password";$(this).val()!==$("#password").val()?matchValidation(e,"The confirm password must be the same as the password"):matchValidation(e,"")}))}},dashboard={ajaxURL:adminURL+"ajax/dashboard/",videosURL:adminURL+"ajax/videos-list/",popularVideos:{list:function(){$("#tbPopularVideos").length&&$("#tbPopularVideos").DataTable({ajax:dashboard.videosURL+"?popular=true",serverSide:!0,columns:[{data:"title",responsivePriority:0,render:function(e,t,a,s){return""===e&&(e="(No Title)"),'<div class="title" contentEditable="plaintext-only" data-toggle="tooltip" title="'+e+'">'+e+"</div>"}},{data:"host",className:"text-center",responsivePriority:1,render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"views",className:"text-right"},{data:"name"},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){return'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(a.actions.embed_code)+btnEmbed(a.actions.embed)+btnDownload(a.actions.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+e)+'<button data-id="'+e+'" onclick="videos.cache.clear.single($(this));" class="dropdown-item" type="button"><i class="fas fa-eraser mr-2 me-2"></i>Clear Cache</button></div></div>'}}],ordering:!1,lengthMenu:[7],pageLength:7,searching:!1,bLengthChange:!1,info:!1,paging:!1,columnDefs:[{orderable:!1,targets:[0,1,2,3,4,5]},{visible:!0,targets:[0,1],className:"noVis"}],drawCallback:function(){loadTooltip(),$("#tbPopularVideos button.alt").click((function(){videos.alternatives.get($(this))})),$("#tbPopularVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")}))}})}},recentVideos:{list:function(){$("#tbRecentVideos").length&&$("#tbRecentVideos").DataTable({ajax:dashboard.videosURL+"?recent=true",serverSide:!0,columns:[{data:"title",responsivePriority:0,render:function(e,t,a,s){return""===e&&(e="(No Title)"),'<div class="title" contentEditable="plaintext-only" data-toggle="tooltip" title="'+e+'">'+e+"</div>"}},{data:"host",responsivePriority:1,className:"text-center",render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"views",className:"text-right"},{data:"name"},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){return'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(a.actions.embed_code)+btnEmbed(a.actions.embed)+btnDownload(a.actions.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+e)+'<button data-id="'+e+'" onclick="videos.cache.clear.single($(this));" class="dropdown-item" type="button"><i class="fas fa-eraser mr-2 me-2"></i>Clear Cache</button></div></div>'}}],ordering:!1,lengthMenu:[7],pageLength:7,searching:!1,bLengthChange:!1,info:!1,paging:!1,columnDefs:[{orderable:!1},{visible:!0,targets:[0,1],className:"noVis"}],drawCallback:function(){loadTooltip(),$("#tbRecentVideos button.alt").click((function(){videos.alternatives.get($(this))})),$("#tbRecentVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")}))}})}},chart:{isDarkMode:function(){return"dark"===Cookies.get("theme")?{backgroundColor:"#191d21",foreColor:"#f0f0f0",mode:"dark"}:{backgroundColor:"#fff",foreColor:"#333",mode:"light"}},apex:{videoStatus:void 0,serverStatus:void 0,views:void 0},videoStatus:function(e){var t=document.querySelector(e+" > .chart"),a=$(e+" > .fa-spin"),s=dashboard.chart.isDarkMode(),o={chart:{id:"videoStatus",type:"donut",foreColor:s.foreColor,backgroundColor:s.backgroundColor},theme:{mode:s.mode},legend:{position:"bottom"},series:[],labels:["Good","Broken","Warning"],colors:["#28a745","#dc3545","#feb019"]};null!==t?(a.show(),t.style.display="none",ajaxPOST(dashboard.ajaxURL,{action:"videosStatus"},(function(e){a.hide(),t.style.display="block","fail"!==e.status&&(o.series[0]=e.result.good,o.series[1]=e.result.broken,o.series[2]=e.result.warning,$("#numVideos").text(e.result.total_videos),$("#numBrokenVideos").text(e.result.broken),$("#numServers").text(e.result.total_servers),$("#numGDrives").text(e.result.total_gdrives)),dashboard.chart.apex.videoStatus=new ApexCharts(t,o),dashboard.chart.apex.videoStatus.render()}),(function(e){a.hide(),t.style.display="block",dashboard.chart.apex.videoStatus=new ApexCharts(t,o),dashboard.chart.apex.videoStatus.render()}))):a.hide()},serverStatus:function(e){var t=document.querySelector(e+" > .chart"),a=$(e+" > .fa-spin"),s=dashboard.chart.isDarkMode(),o={chart:{id:"serverStatus",type:"pie",foreColor:s.foreColor,backgroundColor:s.backgroundColor},theme:{mode:s.mode},legend:{position:"bottom"},series:[],labels:[]};null!==t?(a.show(),t.style.display="none",ajaxPOST(dashboard.ajaxURL,{action:"serversStatus"},(function(e){a.hide(),"fail"!==e.status&&(t.style.display="block",o.labels=Object.keys(e.result),o.series=Object.values(e.result),dashboard.chart.apex.serverStatus=new ApexCharts(t,o),dashboard.chart.apex.serverStatus.render())}),(function(e){a.hide(),t.style.display="block",dashboard.chart.apex.serverStatus=new ApexCharts(t,o),dashboard.chart.apex.serverStatus.render()}))):a.hide()},views:{options:{series:[{name:"Visitors",data:[]}],noData:{text:"No data",align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{fontSize:"15px"}},chart:{id:"chartViews",type:"area",height:300,toolbar:{show:!1},zoom:{enabled:!1}},theme:{mode:"light"},dataLabels:{enabled:!1},markers:{size:0,style:"hollow"},xaxis:{type:"datetime",tickAmount:6,labels:{datetimeUTC:!1}},tooltip:{x:{format:"dd MMM yyyy"}},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.9,stops:[0,100]}}},load:function(e,t,a){var s=$("#views > .fas, #userViews > .fas"),o=dashboard.chart.views.options,i=dashboard.chart.isDarkMode();o.colors=window.themeColors,o.fill={gradient:{gradientColors:window.themeColors,shadeIntensity:1,opacityFrom:.7,opacityTo:.9,stops:[0,100]}},a&&(a.innerHTMl="",o.chart.foreColor=i.foreColor,o.chart.backgroundColor=i.backgroundColor,o.theme.mode=i.mode,s.show(),ajaxPOST(dashboard.ajaxURL,{action:"views",filter:e,uid:t},(function(e){var t=[];s.hide(),"fail"!==e.status&&(e.result.length<30&&(o.dataLabels.enabled=!0),e.result.length&&$.each(e.result,(function(e,a){t.push([1e3*a[0],a[1]])})),o.series=[{name:"Visitors",data:t}],void 0===dashboard.chart.apex.views?(dashboard.chart.apex.views=new ApexCharts(a,o),dashboard.chart.apex.views.render()):dashboard.chart.apex.views.updateOptions(o))}),(function(e){s.hide()})))}}},supportChecker:function(){if(location.href.indexOf("/dashboard")>-1){var e=$("#modalExtApps");e.find(".btn-success").html('<i class="fas fa-spin fa-refresh mr-2 me-2"></i>Re-check').prop("disable",!0),ajaxPOST(adminURL+"ajax/settings/",{action:"getDependencies"},(function(t){var a;null!==t.result&&(a=Object.keys(t.result),$.each(a,(function(e,a){var s,o,i;s="#php_"+a,o=t.result[a],i="chrome"===a,o?(i=i?"Installed":"Enabled",$(s).html('<i class="fas fa-check-circle text-success mr-2 me-2"></i>'+i)):(i=i?"Uninstalled":"Disabled",$(s).html('<i class="fas fa-times-circle text-danger mr-2 me-2"></i>'+i))})),e.find(".btn-success").text("Re-check").prop("disable",!1),"fail"===t.status?e.modal("show"):e.modal("hide"))}),(function(t){e.find(".btn-success").text("Re-check").prop("disable",!1),e.modal("show")}))}}},gdrive_accounts={url:adminURL+"ajax/gdrive-accounts/",delete:{ajax:function(e,t,a){ajaxPOST(gdrive_accounts.url,{id:e,action:"delete"},t,a)},single:function(e){swalQuestion("Are you sure?","Delete the '"+e.data("name")+"' account. "+notRecovered(),(function(t){t&&gdrive_accounts.delete.ajax(e.data("id"),(function(e){"ok"===e.status?(gdrive_accounts.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDA, #ckAllGDA1").prop("checked",!1),$("#tbGDAccounts tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,i){var n,l=i+1;"fail"!==s.status?t.push(e[i]):a.push(e[i]),(n=t.length+a.length)>=e.length?(gdrive_accounts.reload(),a.length>0?swalInfo("The "+t.length+" accounts have been successfully deleted and the other "+a.length+" accounts failed to be deleted."):swalSuccess("These "+n+" accounts have been successfully deleted.")):o(e[l],l)},o=function(e,t){gdrive_accounts.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swalQuestion("Are you sure?","You will delete these "+e.length+" accounts. "+notRecovered(),(function(t){t&&o(e[0],0)}))}else swalWarning("Please check the accounts you want to delete first.")}},update_status:{ajax:function(e,t,a){ajaxPOST(gdrive_accounts.url,e,t,a)},single:function(e,t){gdrive_accounts.update_status.ajax({id:e.data("id"),status:e.data(t),action:"update"+capitalizeWords(t)},(function(e){"fail"!==e.status?(gdrive_accounts.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}},list:function(){$("#tbGDAccounts").length&&$("#tbGDAccounts").DataTable({ajax:adminURL+"ajax/gdrive-accounts-list/",serverSide:!0,columns:[{data:"id",className:"text-center",render:function(e,t,a,s){return btnCheckbox(e,"gdaccount","#tbGDAccounts")}},{data:"email",responsivePriority:0},{data:"bypass",responsivePriority:1,className:"text-center",render:function(e,t,a,s){var o="fa-times-circle text-danger",i="Disable";return 1==e?(o="fa-check-circle text-success",i="Enable",e=0):e=1,'<a href="javascript:void(0)" role="button" data-id="'+a.id+'" data-bypass="'+e+'" class="bypass" data-toggle="tooltip" title="'+i+'"><i class="fas fa-lg '+o+'"></i></a>'}},{data:"status",responsivePriority:1,className:"text-center",render:function(e,t,a,s){var o="fa-times-circle text-danger",i="Disable";return 1==e?(o="fa-check-circle text-success",i="Enable",e=0):e=1,'<a href="javascript:void(0)" role="button" data-id="'+a.id+'" data-status="'+e+'" class="status" data-toggle="tooltip" title="'+i+'"><i class="fas fa-lg '+o+'"></i></a>'}},{data:"created",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"modified",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){return'<div class="dropdown">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnEditItem(adminURL+"gdrive/edit/?id="+e)+btnDeleteItem(e,a.email)+"</div></div>"}}],columnDefs:[{orderable:!1,targets:[0,6]},{visible:!0,targets:[0,1,6],className:"noVis"}],order:[[1,"asc"]],drawCallback:function(){loadTooltip(),$("#tbGDAccounts a.status").click((function(){gdrive_accounts.update_status.single($(this),"status")})),$("#tbGDAccounts a.bypass").click((function(){gdrive_accounts.update_status.single($(this),"bypass")})),$("#tbGDAccounts button.delete").click((function(){gdrive_accounts.delete.single($(this))}))}})},reload:function(){$("#ckAllGDA, #ckAllGDA1").prop("checked",!1),$(".toolbar .btn-hidden").addClass("d-none"),$("#tbGDAccounts").DataTable().ajax.reload(null,!1)}},gdrive_files={url:adminURL+"ajax/gdrive-files/",removeDuplicateFiles:function(e){var t=$("#btnGDuplicate");t.find(".fas").removeClass("fa-copy").addClass("fa-spin fa-rotate"),t.prop("disabled",!0),ajaxPOST(gdrive_files.url,{email:$_GET("email"),action:"removeDuplicateFiles",nextPageToken:e},(function(e){t.find(".fas").removeClass("fa-spin fa-rotate").addClass("fa-copy"),t.prop("disabled",!1),"fail"!==e.status?""!==e.result.nextPageToken?gdrive_files.removeDuplicateFiles(e.result.nextPageToken):swalSuccess(e.message):swalError(e.message)}),(function(e){t.find(".fas").removeClass("fa-spin fa-rotate").addClass("fa-copy"),t.prop("disabled",!1),swalError(e.responseText)}))},update_status:{ajax:function(e,t,a){ajaxPOST(gdrive_files.url,e,t,a)},single:function(e){gdrive_files.update_status.ajax({id:e.data("id"),email:$_GET("email"),action:"updateStatus",public:"public"==e.data("status")},(function(e){"fail"!==e.status?(gdrive_files.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))},multi:function(e){var t=[],a=[],s=[];if($("#ckAllGDF, #ckAllGDF1").prop("checked",!1),$("#tbGDFiles tbody input[type=checkbox]:checked").each((function(){t.push($(this).val())})),t.length>0){var o=function(e,o){var n,l=o+1;"fail"!==e.status?a.push(t[o]):s.push(t[o]),(n=a.length+s.length)>=t.length?(gdrive_files.reload(),s.length>0?swalInfo(a.length+" files have been updated successfully and "+s.length+" other files failed to update."):swalSuccess("These "+n+" files have been successfully updated.")):i(t[l],l)},i=function(t,a){gdrive_files.update_status.ajax({id:t,email:$_GET("email"),action:"updateStatus",public:"public"===e},(function(e){o(e,a)}),(function(e){o({status:"fail"},a)}))};swalQuestion("Are you sure?","You will change the status of those "+t.length+" files to "+e+".",(function(e){e&&i(t[0],0)}))}else swalWarning("Please check the files that you want to change the status of first.")}},reload:function(){$("#ckAllGDF, #ckAllGDF1").prop("checked",!1),$(".toolbar .btn-hidden").addClass("d-none"),$("#tbGDFiles").DataTable().ajax.reload(null,!1)},list:function(){if($("#tbGDFiles").length){var e=$("select#email").val(),t=md5(e);$("#tbGDFiles").on("preXhr.dt",(function(a,s,o){var i=s._iDisplayStart-s._iDisplayLength;o.private=$("#onlyPrivate").is(":checked"),o.onlyFolder=$("#onlyFolder").is(":checked"),null!==e&&(o.email=e,o.folder_id=$_GET("folder_id")),i>=0&&(o.token=localStorage.getItem("nextPageToken-"+t+"-"+i))})).DataTable({ajax:adminURL+"ajax/gdrive-files-list/",serverSide:!0,info:!1,pagingType:"simple",columns:[{data:"id",responsivePriority:0,className:"text-center",render:function(e,t,a,s){return btnCheckbox(e,"gdfile","#tbGDFiles")}},{data:"title",responsivePriority:1,render:function(e,t,a,s){return"type"in a.mimeType&&-1===a.mimeType.type.indexOf(".folder")?'<div class="title" contentEditable="plaintext-only" data-toggle="tooltip" title="'+e+'"><img src="'+a.mimeType.icon+'" class="mr-2 me-2">'+e+"</div>":""!==a.id?'<a href="'+adminURL+"gdrive/files/?email="+a.email+"&folder_id="+a.id+'" class="title" data-toggle="tooltip" title="'+e+'"><img src="'+a.mimeType.icon+'" class="mr-2 me-2">'+e+"</a>":'<a href="'+adminURL+"gdrive/files/?email="+a.email+'" class="title" data-toggle="tooltip" title="Back">'+e+"</a>"}},{data:"desc",responsivePriority:2,render:function(e,t,a,s){return'<div class="title" contentEditable="plaintext-only" data-toggle="tooltip" title="'+e+'">'+e+"</div>"}},{data:"shared",className:"text-center",render:function(e,t,a,s){return'<i class="fas fa-lg fa-'+(e?"check-circle text-success":"times-circle text-danger")+'"></i>'}},{data:"modifiedDate",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"actions",className:"text-center",responsivePriority:3,render:function(e,t,a,s){if(""!==a.id){var o='<button type="button" class="dropdown-item rename" data-id="'+e.id+'" data-name="'+a.title+'"><i class="fas fa-pen-to-square mr-2 me-2"></i>Rename</button>';return e.shared?o+='<button type="button" class="dropdown-item private" data-id="'+e.id+'" data-status="private" title="Make it Private"><i class="fas fa-eye-slash mr-2 me-2"></i>Private</button>':o+='<button type="button" class="dropdown-item public" data-id="'+e.id+'" data-status="public" title="Share with the Public"><i class="fas fa-eye mr-2 me-2"></i>Public</button>',o+='<button type="button" class="dropdown-item delete" data-id="'+e.id+'" data-name="'+a.title+(""!==a.desc?" - "+a.desc:"")+'"><i class="fas fa-trash mr-2 me-2"></i>Delete</button>',"type"in a.mimeType&&-1===a.mimeType.type.indexOf(".folder")&&(o+='<div class="dropdown-divider"></div><a class="dropdown-item" href="'+e.view+'" target="_blank"><i class="fas fa-binoculars mr-2 me-2"></i>View</a><a class="dropdown-item" href="'+e.download+'" target="_blank"><i class="fas fa-download mr-2 me-2"></i>Download</a><a class="dropdown-item" href="'+e.preview+'" target="_blank"><i class="fas fa-magnifying-glass mr-2 me-2"></i>Preview</a><div class="dropdown-divider"></div>'+btnEmbed(e.embed_url)+btnDownload(e.download_url)+btnCopyEmbed(e.embed_code)),'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+o+"</div></div>"}return""}}],columnDefs:[{orderable:!1,targets:[0,2,3,5]},{visible:!0,targets:[0,1,2],className:"noVis"}],order:[[4,"desc"]],drawCallback:function(a){null!==e&&void 0!==a.json.token&&null!==a.json.token&&""!==a.json.token&&localStorage.setItem("nextPageToken-"+t+"-"+a._iDisplayStart,a.json.token),$("#tbGDFiles button.public, #tbGDFiles button.private").click((function(){gdrive_files.update_status.single($(this))})),$("#tbGDFiles button.delete").click((function(){gdrive_files.delete.single($(this))})),$("#tbGDFiles button.rename").click((function(){gdrive_files.rename($(this))})),$("#tbGDFiles button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")})),gdrive_files.loadDrives(),loadTooltip()}})}},delete:{ajax:function(e,t,a){ajaxPOST(gdrive_files.url,{id:e,email:$_GET("email"),action:"delete"},t,a)},single:function(e){swalQuestion("Are you sure?","Delete the '"+e.data("name")+"' file.",(function(t){t&&gdrive_files.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(gdrive_files.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDF, #ckAllGDF1").prop("checked",!1),$("#tbGDFiles tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,i){var n,l=i+1;"fail"!==s.status?t.push(e[i]):a.push(e[i]),(n=t.length+a.length)>=e.length?(gdrive_files.reload(),a.length>0?swalInfo("The "+t.length+" files have been successfully deleted and the other "+a.length+" files failed to be deleted."):swalSuccess("The "+n+" files have been successfully deleted.")):o(e[l],l)},o=function(e,t){gdrive_files.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swalQuestion("Are you sure?","You will delete these "+e.length+" files.",(function(t){t&&o(e[0],0)}))}else swalWarning("Please check the files you want to delete first.")}},newFolder:function(){swal({title:"Create New Folder",type:"input",showLoaderOnConfirm:!0,showCancelButton:!0,closeOnConfirm:!1,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-success",inputPlaceholder:"Folder Name",confirmButtonText:"Save"},(function(e){if(!1===e)return!1;if(""===e.trim())return swal.showInputError("You need to write something!"),!1;var t=$_GET("folder_id");t=null!==t?t:"root",$.ajax({url:gdrive_files.url,method:"POST",dataType:"json",data:"action=createNewFolder&name="+e+"&parent_id="+t+"&email="+$("select#email").val(),success:function(e){"fail"!==e.status?(gdrive_files.reload(),swalSuccess(e.message)):swalError(e.message)},error:function(e){swalError(e.responseText)}})}))},changeEmail:function(e){localStorage.clear(),location.href=location.href.split("?")[0]+"?email="+e.val()},import:{ajax:function(e,t,a){ajaxPOST(gdrive_files.url,{id:e,action:"gdriveImport"},t,a)},single:function(e){gdrive_files.import.ajax(e.data("id"),(function(e){"fail"!==e.status?swalSuccess(e.message):swalError(e.message)}),(function(e){swalError(e.responseText)}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDF, #ckAllGDF1").prop("checked",!1),$("#tbGDFiles tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,i){var n,l=i+1;"fail"!==s.status?t.push(e[i]):a.push(e[i]),(n=t.length+a.length)>=e.length?(a.length>0?swalInfo("The "+t.length+" files have been successfully imported and the other "+a.length+" files failed to be imported."):swalSuccess("The "+n+" files have been successfully imported."),gdrive_files.reload()):o(e[l],l)},o=function(e,t){gdrive_files.import.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};o(e[0],0)}else swalWarning("Please check the files you want to import first.")}},loadDrives:function(){var e=$("#drives").find("optgroup");ajaxPOST(gdrive_files.url,{email:$_GET("email"),action:"getSharedDrives"},(function(t){if(t.result.length)for(var a in e.html(""),t.result)e.append('<option value="'+t.result[a].id+'" '+($_GET("folder_id")===t.result[a].id?"selected":"")+">"+t.result[a].name+"</option>")}),(function(e){console.log(e)}))},rename:function(e){swal({title:"Rename File/Folder",type:"input",inputValue:e.data("name"),showLoaderOnConfirm:!0,showCancelButton:!0,closeOnConfirm:!1,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-success",inputPlaceholder:"File/Folder Name",confirmButtonText:"Update"},(function(t){return!1!==t&&(""===t.trim()?(swal.showInputError("You need to write something!"),!1):void $.ajax({url:gdrive_files.url,method:"POST",dataType:"json",data:"action=renameFileFolder&name="+t+"&id="+e.data("id")+"&email="+$("select#email").val(),success:function(e){"fail"!==e.status?(gdrive_files.reload(),swalSuccess(e.message)):swalError(e.message)},error:function(e){swalError(e.responseText)}}))}))}},gdrive_backup_files={url:adminURL+"ajax/gdrive-backup-files/",reload:function(){$("#ckAllGDBF, #ckAllGDBF1").prop("checked",!1),$(".toolbar .btn-hidden").addClass("d-none"),$("#tbGDBackupFiles").DataTable().ajax.reload(null,!1)},list:function(){$("#tbGDBackupFiles").length&&$("#tbGDBackupFiles").DataTable({ajax:adminURL+"ajax/gdrive-backup-files-list/",serverSide:!0,columns:[{data:"id",responsivePriority:0,className:"text-center",render:function(e){return btnCheckbox(e,"backup","#tbGDBackupFiles")}},{data:"gdrive_id",responsivePriority:1,render:function(e){return gdriveViewLink(e)}},{data:"mirror_id",responsivePriority:2,render:function(e){return gdriveViewLink(e)}},{data:"mirror_email"},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",responsivePriority:3,render:function(e,t,a){return'<button data-id="'+e+'" data-name="'+a.mirror_id+'" data-toggle="tooltip" title="Delete" type="button" class="btn btn-danger btn-sm delete"><i class="fas fa-trash-alt"></i></button>'}}],columnDefs:[{orderable:!1,targets:[0,5]},{visible:!0,targets:[0,3,4],className:"noVis"}],order:[[4,"desc"]],drawCallback:function(){loadTooltip(),$("#tbGDBackupFiles button.delete").click((function(){gdrive_backup_files.delete.single($(this))}))}})},delete:{ajax:function(e,t,a){ajaxPOST(gdrive_backup_files.url,{id:e,action:"delete"},t,a)},single:function(e){swalQuestion("Are you sure?","Delete backup file '"+e.data("name")+"'. "+notRecovered(),(function(t){t&&gdrive_backup_files.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(gdrive_backup_files.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDBF, #ckAllGDBF1").prop("checked",!1),$("#tbGDBackupFiles tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,i){var n,l=i+1;"fail"!==s.status?t.push(e[i]):a.push(e[i]),(n=t.length+a.length)>=e.length?(gdrive_backup_files.reload(),a.length>0?swalInfo(t.length+" backup files were successfully deleted and "+a.length+" other backup files failed to be deleted."):swalSuccess("These "+n+" backup files have been successfully deleted.")):o(e[l],l)},o=function(e,t){gdrive_backup_files.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swalQuestion("Are you sure?","You will delete "+e.length+" backup files. "+notRecovered(),(function(t){t&&o(e[0],0)}))}else swalWarning("Please check the backup files you want to delete first.")}}},gdrive_backup_queue={url:adminURL+"ajax/gdrive-backup-queue/",reload:function(){$("#ckAllGDQF, #ckAllGDQF1").prop("checked",!1),$(".toolbar .btn-hidden").addClass("d-none"),$("#tbGDBackupQueue").DataTable().ajax.reload(null,!1)},list:function(){$("#tbGDBackupQueue").length&&$("#tbGDBackupQueue").DataTable({ajax:adminURL+"ajax/gdrive-backup-queue-list/",serverSide:!0,columns:[{data:"id",className:"text-center",responsivePriority:2,render:function(e){return btnCheckbox(e,"queue","#tbGDBackupQueue")}},{data:"gdrive_id",responsivePriority:0,render:function(e){return gdriveViewLink(e)}},{data:"id",className:"text-center",responsivePriority:1,render:function(e,t,a){return'<button data-id="'+a.gdrive_id+'" data-toggle="tooltip" title="Copy File" type="button" class="btn btn-primary btn-sm copy-file"><i class="fas fa-copy"></i></button>&nbsp;<button data-id="'+e+'" data-name="'+a.gdrive_id+'" data-toggle="tooltip" title="Delete" type="button" class="btn btn-danger btn-sm delete"><i class="fas fa-trash-alt"></i></button>'}}],columnDefs:[{orderable:!1,targets:[0,2]},{visible:!0,targets:[0,1],className:"noVis"}],drawCallback:function(){loadTooltip(),$("#tbGDBackupQueue button.delete").click((function(){gdrive_backup_queue.delete.single($(this))})),$("#tbGDBackupQueue button.copy-file").click((function(){$(this).prop("disabled",!0),gdrive_backup_queue.copy($(this))}))}})},copy:function(e){ajaxPOST(gdrive_backup_queue.url,{id:e.data("id"),action:"copy"},(function(t){"fail"!==t.status?(gdrive_backup_queue.reload(),swalSuccess(t.message)):(e.prop("disabled",!1),swalError(t.message))}),(function(t){e.prop("disabled",!1),swalError(t.responseText)}))},delete:{ajax:function(e,t,a){ajaxPOST(gdrive_backup_queue.url,{id:e,action:"delete"},t,a)},single:function(e){swalQuestion("Are you sure?","Delete backup queue '"+e.data("name")+"'. "+notRecovered(),(function(t){t&&gdrive_backup_queue.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(gdrive_backup_queue.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDQF, #ckAllGDQF1").prop("checked",!1),$("#tbGDBackupQueue tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,i){var n,l=i+1;"fail"!==s.status?t.push(e[i]):a.push(e[i]),(n=t.length+a.length)>=e.length?(gdrive_backup_queue.reload(),a.length>0?swalInfo(t.length+" backup queue were successfully deleted and "+a.length+" other backup queue failed to be deleted."):swalSuccess("These "+n+" backup queue have been successfully deleted.")):o(e[l],l)},o=function(e,t){gdrive_backup_queue.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swalQuestion("Are you sure?","You will delete "+e.length+" backup queue. "+notRecovered(),(function(t){t&&o(e[0],0)}))}else swalWarning("Please check the backup files you want to delete first.")}}},load_balancers={url:adminURL+"ajax/load-balancers/",reload:function(){$("#tbLoadBalancers").DataTable().ajax.reload(null,!1)},delete:function(e){swalQuestion("Are you sure?","Delete the '"+e.data("name")+"' server. "+notRecovered(),(function(t){t&&ajaxPOST(load_balancers.url,{id:e.data("id"),action:"delete"},(function(e){"fail"!==e.status?(load_balancers.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},update_status:function(e){ajaxPOST(load_balancers.url,{id:e.data("id"),status:e.data("status"),action:"updateStatus"},(function(e){"fail"!==e.status?(load_balancers.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))},list:function(){$("#tbLoadBalancers").length&&$("#tbLoadBalancers").DataTable({ajax:adminURL+"ajax/load-balancers-list/",serverSide:!0,columns:[{data:"name",responsivePriority:0},{data:"link",responsivePriority:1,render:function(e,t,a,s){return'<a href="'+e+'" target="_blank">'+e+"</a>"}},{data:"connections",className:"text-right"},{data:"playbacks",className:"text-right"},{data:"status",className:"text-center",render:function(e,t,a,s){var o="fa-check-circle text-success",i="Disable";return 0==e?(o="fa-times-circle text-danger",i="Enable",e=1):e=0,'<a href="javascript:void(0)" class="status" data-id="'+a.id+'" data-status="'+e+'" data-toggle="tooltip" title="'+i+'"><i class="fas fa-lg '+o+'"></i></a>'}},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"updated",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){return'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnEditItem(adminURL+"settings/load-balancers/edit/?id="+e)+btnDeleteItem(e,a.name)+'<button type="button" class="dropdown-item clear" data-id="'+e+'" data-url="'+a.link+'ajax/admin-api/"><i class="fas fa-refresh mr-2 me-2"></i>Clear Cache</button></div></div>'}}],columnDefs:[{orderable:!1,targets:[7]},{visible:!0,targets:[1,2,3,4,5],className:"noVis"}],order:[[5,"desc"]],drawCallback:function(){loadTooltip(),$("a.status").click((function(){load_balancers.update_status($(this))})),$("#tbLoadBalancers button.clear").click((function(){load_balancers.clear($(this))})),$("#tbLoadBalancers button.delete").click((function(){load_balancers.delete($(this))}))}})},clear:function(e){ajaxPOST(e.data("url"),{id:e.data("id"),action:"clearLoadBalancer",token:Cookies.get("adv_token",main.cookieConfig)},(function(e){"fail"!==e.status?swalSuccess(e.message):swalError(e.message)}),(function(e){swalError(e.responseText)}))},resetHost:function(){$("#resetLBHost").prop("disabled",!0),ajaxPOST(settings.url,{action:"resetHosts"},(function(e){$("#resetLBHost").prop("disabled",!1),"fail"!==e.status?($("#bypass_hosts").find("option").removeAttr("selected"),$("#bypass_hosts").multiSelect("select",e.result),$("#bypass_hosts").multiSelect("refresh"),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}},settings={url:adminURL+"ajax/settings/",disableBlacklistedVideos:function(e){swalQuestion("Are you sure?","You will disable videos with titles containing blacklisted words.",(function(t){t&&(e.prop("disabled",!0),ajaxPOST(settings.url,{action:"disableBlacklistedVideos"},(function(t){"fail"!==t.status?($("#word_blacklisted").val(t.result),swalSuccess(t.message)):swalSuccess(t.message),e.prop("disabled",!1)}),(function(t){swalError(res.responseText),e.prop("disabled",!1)})))}))},smtp:function(){var e=$("#smtp_provider").val(),t=$("#smtp_host"),a=$("#smtp_port"),s=$("#smtp_tls"),o={};"other"!==e?(o={gmail:{host:"smtp.gmail.com",port:465,tls:!1},ymail:{host:"smtp.mail.yahoo.com",port:587,tls:!0},outlook:{host:"smtp.office365.com",port:587,tls:!0}}[e],t.val(o.host),a.val(o.port),s.prop("checked",!0)):(t.val(""),a.val(""),s.prop("checked",!1))},vast:{remove:function(e){$("#vastWrapper .form-group[data-index="+e+"]").remove()},add:function(){var e=$("#vastWrapper"),t=e.find(".form-group").length;e.append('<div class="form-group" data-index="'+t+'"><div class="input-group"><div class="input-group-prepend" style="max-width:110px"><input type="text" placeholder="Ad Position" name="vast_offset[]" id="vast_offset-'+t+'" class="form-control"></div><input type="url" name="vast_xml[]" id="vast_xml-'+t+'" placeholder="VAST URL (.xml)" class="form-control"><div class="input-group-append"><button type="button" class="btn btn-danger" onclick="settings.vast.remove('+t+')" data-toggle="tooltip" title="Remove VAST"><i class="fas fa-minus"></i></button></div></div></div>'),loadTooltip()},delete:function(e){ajaxPOST(settings.url,{action:"deleteCustomVAST",file_name:e.data("id")},(function(t){"fail"!==t.status?swalSuccess(t.message):swalError(t.message),e.closest("li").remove()}),(function(e){swalError(e.responseText)}))}},changeCache:function(e){var t=e.find('option[value="files"]');ajaxPOST(settings.url,{action:"extensionChecker",extension:e.val()},(function(e){"fail"===e.status&&(t.prop("selected",!0),swalError(e.message))}),(function(e){swalError(e.responseText),t.prop("selected",!0)}))},checkProxy:function(){var e=$("#checkProxy"),t=e.html(),a=["proxy_docker_com","free_proxy_cz","free_proxy_list_net"],s=[],o=[],i=function(){s.length+o.length>=a.length&&(e.html(t).prop("disabled",!1),swalSuccess("The proxy list has been successfully updated."))};e.html(t+'<i class="fas fa-spin fa-sync-alt ml-2 ms-2"></i>').prop("disabled",!0),""!==$("#proxy_list").val()?ajaxGET(baseURL+"cron-proxy/",(function(a){"fail"!==a.status?swalSuccess(a.message):swalError(a.message),e.html(t).prop("disabled",!1)}),(function(a){swalError(a.responseText),e.html(t).prop("disabled",!1)})):$.each(a,(function(e,t){!function(e){ajaxGET(baseURL+"cron-proxy/?host="+e,(function(t){"fail"!==t.status?(s.push(e),$("#proxy_list").val(t.result)):o.push(e),i()}),(function(t){o.push(e),i()}))}(t)}))},clearCache:{cleared:0,failed:0,total:0,callback:function(e){var t=settings.clearCache;"fail"!==e.status?t.cleared+=1:t.failed+=1,t.cleared+t.failed>=t.total&&(t.failed>0&&0===t.cleared?swalError("The cache failed to clear or the cache does not exist."):swalSuccess("The cache has been successfully cleared."),$("#clearCache").prop("disabled",!1))},prompt:function(e,t){var a=localStorage.getItem("lb"),s="string"==typeof a?JSON.parse(a):[baseURL],o=settings.clearCache.callback,i={action:t,token:Cookies.get("adv_token",main.cookieConfig)};s.length>0&&swalQuestion("Are you sure!",e,(function(e){e&&($("#clearCache").prop("disabled",!0),$.each(s,(function(e,t){e===s.length-1?ajaxPOST(t+"ajax/settings/",i,o,o):ajaxPOST(t+"ajax/settings/",i)})))}))},all:function(){settings.clearCache.prompt("You will clear all cache.","clearAllCache")},videosFiles:function(){settings.clearCache.prompt("You will clear all video cache files.","clearVideosFiles")},videos:function(){settings.clearCache.prompt("You will clear all videos cache.","clearVideosCache")},settings:function(){settings.clearCache.prompt("You will clear all settings cache.","clearSettingsCache")}},resetHost:function(){var e=$("#resetHost").html();swalQuestion("Are you sure?","Return the hosts to their original position. Then clear the settings cache.",(function(t){t&&($("#resetHost").html(e+'<i class="fas fa-spin fa-sync-alt ml-2 ms-2"></i>').prop("disabled",!0),ajaxPOST(settings.url,{action:"resetHosts"},(function(t){$("#resetHost").html(e).prop("disabled",!1),"fail"!==t.status?($("#bypass_host").find("option").removeAttr("selected"),$("#bypass_host").multiSelect("select",t.result),$("#bypass_host").multiSelect("refresh"),swalSuccess(t.message)):swalError(t.message)}),(function(e){swalError(e.responseText)})))}))}},subtitles={url:adminURL+"ajax/subtitles/",loadHosts:function(){ajaxPOST(subtitles.url,{action:"getHosts"},(function(e){if("fail"!==e.status){var t="",a=$("#oldLocation"),s=0;for(s in a.html(""),e.result)t+='<option value="'+e.result[s]+'">'+e.result[s]+"</option>";a.html(t)}}),(function(e){swalError(e.responseText)}))},html:function(e){var t='<select name="'+e+'" class="form-control select2">';return $.each(languages,(function(e,a){t+='<option value="'+a+'">'+a+"</option>"})),t+"</select>"},migrate:function(){subtitles.loadHosts(),$("#modalHostSub").modal("show"),$("#frmMigrateSub").on("submit",(function(e){e.preventDefault(),e.stopPropagation();var t=$(this).find('button[type="submit"]');!1===this.checkValidity()||t.prop("disabled")?$(this).addClass("was-validated"):$.ajax({type:"POST",url:subtitles.url,cache:!1,data:$(this).serialize(),beforeSend:function(){t.prop("disabled",!0)},complete:function(){t.prop("disabled",!1)},success:function(e){"fail"!==e.status?(subtitles.reload(),showToast(e.message,"success"),$("#frmMigrateSub").get(0).reset()):showToast(e.message,"error")},error:function(){showToast("Server cannot be accessed. Please contact admin!","error")}})}))},rename:function(e){swal({title:"Rename",type:"input",inputValue:e.data("name"),showLoaderOnConfirm:!0,showCancelButton:!0,closeOnConfirm:!1,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-success",inputPlaceholder:"File Name",confirmButtonText:"Save"},(function(t){return!1!==t&&(""===t.trim()?(swal.showInputError("You need to write something!"),!1):void ajaxPOST(subtitles.url,{action:"rename",name:t,id:e.data("id")},(function(e){"fail"!==e.status?(subtitles.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)})))}))},delete:{ajax:function(e,t,a){ajaxPOST(subtitles.url,{action:"delete",id:e},t,a)},single:function(e){swalQuestion("Are you sure?","Delete the '"+e.data("name")+"' subtitle file. "+notRecovered(),(function(t){t&&subtitles.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(subtitles.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllSubtitles, #ckAllSubtitles1").prop("checked",!1),$("#tbSubtitles tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,i){var n,l=i+1;"fail"!==s.status?t.push(e[i]):a.push(e[i]),(n=t.length+a.length)>=e.length?(subtitles.reload(),a.length>0?swalInfo("The "+t.length+" subtitle files have been successfully deleted and the other "+a.length+" subtitle files failed to be deleted."):swalSuccess("The "+n+" subtitle files have been successfully deleted.")):o(e[l],l)},o=function(e,t){subtitles.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swalQuestion("Are you sure?","You will delete "+e.length+" subtitle files. "+notRecovered(),(function(t){t&&o(e[0],0)}))}else swalWarning("Please check the subtitle files you want to delete first.")}},list:function(){$("#tbSubtitles").length&&$("#tbSubtitles").DataTable({ajax:adminURL+"ajax/subtitles-list/",serverSide:!0,columns:[{data:"DT_RowId",responsivePriority:0,className:"text-center",render:function(e,t,a,s){return btnCheckbox(e,"subtitle","#tbSubtitles")}},{data:"file_name",responsivePriority:1,render:function(e,t,a,s){return'<a href="'+a.link+'">'+e+"</a>"}},{data:"language",className:"text-center"},{data:"name"},{data:"host"},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"updated",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){return'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow"><button type="button" class="dropdown-item rename" data-id="'+e+'" data-name="'+a.file_name+'"><i class="fas fa-edit mr-2 me-2"></i>Rename</button><a href="'+a.link+'" class="dropdown-item" download><i class="fas fa-download mr-2 me-2"></i>Download</a>'+btnDeleteItem(e,a.file_name)+"</div></div>"}}],columnDefs:[{orderable:!1,targets:[0,7]},{visible:!0,targets:[0,1,7],className:"noVis"}],order:[[6,"desc"]],drawCallback:function(){loadTooltip(),$("#tbSubtitles button.delete").click((function(){subtitles.delete.single($(this))})),$("#tbSubtitles button.rename").click((function(){subtitles.rename($(this))}))}})},reload:function(){$("#ckAllSubtitles, #ckAllSubtitles1").prop("checked",!1),$(".toolbar .btn-hidden").addClass("d-none"),$("#tbSubtitles").DataTable().ajax.reload(null,!1)},upload:function(){$("#mdUploadSubtitle").modal("show"),$("#frmUploadSubtitle").on("submit",(function(e){e.preventDefault(),e.stopPropagation();var t=new FormData(this),a=$("#frmUploadSubtitle"),s=a.find('input[type="file"]'),o=$(this).find('button[type="submit"]');!1===this.checkValidity()||o.prop("disabled")?$(this).addClass("was-validated"):document.getElementById("uploadSubFile").files.length>0?$.ajax({type:"POST",url:subtitles.url,contentType:!1,processData:!1,cache:!1,data:t,beforeSend:function(){o.prop("disabled",!0)},complete:function(){o.prop("disabled",!1),s.val(""),a.find('label[for="uploadSubFile"]').text(s.attr("placeholder"))},success:function(e){"fail"!==e.status?(subtitles.reload(),showToast(e.message,"success")):showToast(e.message,"error")},error:function(){showToast("Server cannot be accessed. Please contact admin!","error")}}):showToast("Insert the Subtitle File first!","error")}))}},sessions={url:adminURL+"ajax/sessions/",delete:{ajax:function(e,t,a){ajaxPOST(sessions.url,{id:e,action:"delete"},t,a)},single:function(e){swalQuestion("Are you sure?","Delete '"+e.data("name")+"' session. "+notRecovered(),(function(t){t&&sessions.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(sessions.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllSessions, #ckAllSessions1").prop("checked",!1),$("#tbSessions tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,i){var n,l=i+1;"fail"!==s.status?t.push(e[i]):a.push(e[i]),(n=t.length+a.length)>=e.length?(sessions.reload(),a.length>0?swalInfo(t.length+" user sessions were successfully deleted and "+a.length+" other user sessions failed to be deleted."):swalSuccess("These "+n+" user sessions have been successfully deleted.")):o(e[l],l)},o=function(e,t){sessions.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swalQuestion("Are you sure?","You will delete "+e.length+" user sessions. "+notRecovered(),(function(t){t&&o(e[0],0)}))}else swalWarning("Please check the user sessions you want to delete first.")}},list:function(){$("#tbSessions").length&&$("#tbSessions").DataTable({ajax:adminURL+"ajax/sessions-list/",serverSide:!0,columns:[{data:"id",responsivePriority:0,className:"text-center",render:function(e){return btnCheckbox(e,"session","#tbSessions")}},{data:"username",responsivePriority:1},{data:"ip",responsivePriority:2},{data:"useragent",render:function(e){return'<div contentEditable="plaintext-only" class="title">'+e+"</div>"}},{data:"created",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"expired",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",responsivePriority:3,render:function(e,t,a){return'<button data-id="'+e+'" data-name="'+a.username+'" data-toggle="tooltip" title="Delete" type="button" class="btn btn-danger btn-sm delete"><i class="fas fa-trash"></i></button>'}}],columnDefs:[{orderable:!1,targets:[0,6]},{visible:!0,targets:[0,1,2],className:"noVis"}],order:[[5,"desc"]],drawCallback:function(){loadTooltip(),$("#tbSessions button.delete").click((function(){sessions.delete.single($(this))}))}})},reload:function(){$("#ckAllSessions, #ckAllSessions1").prop("checked",!1),$(".toolbar .btn-hidden").addClass("d-none"),$("#tbSessions").DataTable().ajax.reload(null,!1)}},users={url:adminURL+"ajax/users/",profileURL:adminURL+"ajax/profile/",delete:function(e){swalQuestion("Are you sure?","Delete the user with the username '"+e.data("name")+"'. "+notRecovered(),(function(t){t&&ajaxPOST(users.url,{id:e.data("id"),action:"delete"},(function(e){"fail"!==e.status?($("#tbUsers").DataTable().ajax.reload(null,!1),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},list:function(){$("#tbUsers").length&&$("#tbUsers").DataTable({ajax:adminURL+"ajax/users-list/",serverSide:!0,columns:[{data:"name",responsivePriority:0},{data:"user"},{data:"email"},{data:"status",className:"text-center",render:function(e,t,a){var s="Inactive",o="fa-times-circle text-danger";return 1==e?(s="Active",o="fa-check-circle text-success"):2==e&&(s="Need Approval",o="fa-question-circle text-info"),'<i class="fas fa-lg '+o+'" data-toggle="tooltip" title="'+s+'"></i>'}},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"updated",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"role"},{data:"videos",className:"text-right"},{data:"id",className:"text-center",responsivePriority:1,render:function(e,t,a){return'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnEditItem(adminURL+"users/edit/?id="+e)+btnDeleteItem(a.id,a.name)+'<button class="dropdown-item showStat" data-id="'+e+'" type="button"><i class="fas fa-chart-line mr-2 me-2"></i>Statistics</button></div></div>'}}],columnDefs:[{orderable:!1,targets:[8]},{visible:!0,targets:[0,8],className:"noVis"}],order:[[4,"desc"]],drawCallback:function(){loadTooltip(),$("#tbUsers button.delete").click((function(){users.delete($(this))})),$("#tbUsers button.showStat").click((function(){var e=$("#modalUserStats");e.modal("show"),e.find("#statUserID").val($(this).data("id"))}))}})},changeEmail:function(e){void 0!==e&&""!==e&&ajaxPOST(users.profileURL,{action:"editEmail",email:e},(function(e){"fail"!==e.status?(swalSuccess(e.message),location.href=adminURL+"login/"):swalError(e.message)}),(function(e){swalError(e.responseText)}))},changeUsername:function(e){void 0!==e&&""!==e&&ajaxPOST(users.profileURL,{action:"editUsername",user:e},(function(e){"fail"!==e.status?(swalSuccess(e.message),location.href=adminURL+"login/"):swalError(e.message)}),(function(e){swalError(e.responseText)}))},stats:{videosStatus:function(e){void 0!==typeof e&&ajaxPOST(dashboard.ajaxURL,{action:"videosStatus",uid:e},(function(e){"fail"!==e.status&&($("#numUserVideos").text(e.result.total_videos),$("#numUserBrokenVideos").text(e.result.broken))}))},recentVideos:function(e){$("#tbUserRecentVideos").length&&void 0!==typeof e&&$("#tbUserRecentVideos").DataTable({ajax:dashboard.videosURL+"?recent=true&uid="+e,serverSide:!0,columns:[{data:"title",responsivePriority:0,render:function(e,t,a,s){return""===e&&(e="(No Title)"),'<div class="title" contentEditable="plaintext-only" data-toggle="tooltip" title="'+e+'">'+e+"</div>"}},{data:"host",className:"text-center",render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"views",className:"text-right"},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",render:function(e,t,a){return'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(a.actions.embed_code)+btnEmbed(a.actions.embed)+btnDownload(a.actions.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+e)+'<button data-id="'+e+'" onclick="videos.cache.clear.single($(this));" class="dropdown-item" type="button"><i class="fas fa-eraser mr-2 me-2"></i>Clear Cache</button></div></div>'}}],ordering:!1,lengthMenu:[7],pageLength:7,searching:!1,bLengthChange:!1,info:!1,paging:!1,columnDefs:[{orderable:!1,targets:[0,1,2,3,4]},{visible:!0,targets:[0,1],className:"noVis"}],drawCallback:function(){loadTooltip(),$("#tbUserRecentVideos button.alt").click((function(){videos.alternatives.get($(this))})),$("#tbUserRecentVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")}))}})},popularVideos:function(e){$("#tbUserPopularVideos").length&&void 0!==typeof e&&$("#tbUserPopularVideos").DataTable({ajax:dashboard.videosURL+"?popular=true&uid="+e,serverSide:!0,columns:[{data:"title",responsivePriority:0,render:function(e,t,a,s){return""===e&&(e="(No Title)"),'<div class="title" contentEditable="plaintext-only" data-toggle="tooltip" title="'+e+'">'+e+"</div>"}},{data:"host",className:"text-center",render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"views",className:"text-right"},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",render:function(e,t,a){return'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(a.actions.embed_code)+btnEmbed(a.actions.embed)+btnDownload(a.actions.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+e)+'<button data-id="'+e+'" onclick="videos.cache.clear.single($(this));" class="dropdown-item" type="button"><i class="fas fa-eraser mr-2 me-2"></i>Clear Cache</button></div></div>'}}],ordering:!1,lengthMenu:[7],pageLength:7,searching:!1,bLengthChange:!1,info:!1,paging:!1,columnDefs:[{orderable:!1,targets:[0,1,2,3,4]},{visible:!0,targets:[0,1],className:"noVis"}],drawCallback:function(){loadTooltip(),$("#tbPopularVideos button.alt").click((function(){videos.alternatives.get($(this))})),$("#tbPopularVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")}))}})}}},videos={url:adminURL+"ajax/videos/",importUrl:adminURL+"ajax/videos-import/",exportUrl:adminURL+"ajax/videos-export/",alternatives:{add:function(e){var t=$("#altWrapper"),a=t.find(".input-group").length,s='<div class="form-group" data-index="'+a+'"><div class="input-group"><input type="url" id="altLink-'+a+'" name="altLinks[]" class="form-control" placeholder="Insert alternative video url here" value="'+(void 0!==e?e:"")+'"><div class="input-group-append"><button type="button" data-toggle="tooltip" title="Remove Alternative Video URL" class="btn btn-danger" onclick="videos.alternatives.remove('+a+')"><i class="fas fa-minus"></i></button><a href="javascript:void(0)" data-toggle="tooltip" title="Move" class="btn btn-outline-secondary move"><i class="fas fa-expand-arrows-alt"></i></a></div></div></div>';t.prepend(s),loadTooltip()},remove:function(e){$('#altWrapper .form-group[data-index="'+e+'"]').remove(),$('body > [role="tooltip"]').remove()},get:function(e){var t=e.next(".dropdown-menu");ajaxPOST(videos.url,{action:"getAlternatives",id:e.data("id")},(function(a){if("fail"!==a.status){var s="Direct URL",o="direct";t.html(""),$.each(a.result,(function(t,a){""!==a.host&&void 0!==vidHosts[a.host]&&("direct"===a.host?a.url.indexOf(".m3u")>-1||a.url.indexOf("hls")>-1?(o="m3u",s="HLS URL"):a.url.indexOf(".mpd")>-1||a.url.indexOf("mpd")>-1?(o="mpd",s="MPEG-DASH URL"):(o=a.host,s=vidHosts[a.host]):(o=a.host,s=vidHosts[a.host]),e.next(".dropdown-menu.show").append('<a class="dropdown-item" href="'+a.url+'" target="_blank"><img src="'+imgCDNURL+"assets/img/logo/"+o+'.png" width="16" height="16" class="mr-2 me-2">'+s.replace("|Additional Host","").replace("|New","")+"</a>"))}))}else swalError(a.message)}),(function(e){swalError("Failed to fetch data from server! Please contact the admin.")}))}},cache:{clear:{ajax:function(e,t,a){var s=localStorage.getItem("lb"),o="null"!==s?JSON.parse(s):[baseURL],i={id:e,action:"clearVideoCache",token:Cookies.get("adv_token",main.cookieConfig)};o.length>0&&$.each(o,(function(e,s){e===o.length-1?ajaxPOST(s+"ajax/admin-api/",i,t,a):ajaxPOST(s+"ajax/admin-api/",i)}))},single:function(e){videos.cache.clear.ajax(e.data("id"),(function(e){"fail"!==e.status?swalSuccess(e.message):swalError(e.message)}),(function(e){swalError(e.responseText)}))},multi:function(e){var t=[],a=[],s=[];if($("#ckAllVideos, #ckAllVideos1").prop("checked",!1),$("#tbVideos tbody input[type=checkbox]:checked").each((function(){t.push($(this).val())})),t.length>0){var o=function(e,o){var n,l=o+1;"fail"!==e.status?a.push(t[o]):s.push(t[o]),(n=a.length+s.length)>=t.length?s.length>0?swalInfo("Cache of "+a.length+" videos was successfully cleared and cache of "+s.length+" other videos failed to clear."):swalSuccess("These "+n+" videos have been successfully deleted."):i(t[l],l)},i=function(e,t){videos.cache.clear.ajax(e,(function(e){o(e,t)}),(function(e){o({status:"fail"},t)}))};swalQuestion("Are you sure?","You will clear the stored cache of "+t.length+" videos.",(function(e){e&&i(t[0],0)}))}else swalWarning("Please check the videos you want to clear cache stored first.")}}},checker:{multi:function(e){var t=$("#tbVideos tbody"),a=t.find("input[type=checkbox]:checked"),s=function(e,t,s){ajaxPOST(videos.url,{action:"updateStatus",id:e,sources:t},(function(e){o($(a[s]).val(),s)}),(function(e){o($(a[s]).val(),s)}))},o=function(t,i){var n=i+1;i<=a.length?ajaxPOST(videos.url,{action:"getServer",id:t,source:"db"},(function(e){"fail"!==e.status?function(e,t,i){var n=e.split("?");ajaxPOST(n[0],n[1],(function(e){"fail"!==e.status?s(t,e.sources,i):s(t,[],i)}),(function(e){o($(a[i]).val(),i)}))}(e.result,t,n):o($(a[n]).val(),n)}),(function(e){o($(a[n]).val(),n)})):(videos.reload(),e.prop("disabled",!1))};a.length>0?(e.prop("disabled",!0),a.each((function(e,a){t.find("#status-"+$(this).val()).attr("class","fas fa-spin fa-lg fa-sync-alt text-info")})),o($(a[0]).val(),0)):swalWarning("Please select the video you want to check!")}},delete:{ajax:function(e,t,a){ajaxPOST(videos.url,{id:e,action:"delete"},t,a)},single:function(e){var t=e.data("id");swalQuestion("Are you sure?","Delete the '"+e.data("name")+"' video. "+notRecovered(),(function(a){a&&(e.prop("disabled",!0),videos.delete.ajax(t,(function(t){"fail"!==t.status?(videos.reload(),swalSuccess(t.message)):(e.prop("disabled",!1),swalError(t.message))}),(function(t){swalError("Failed to fetch data from server! Please contact the admin."),e.prop("disabled",!1)})))}))},multi:function(e){var t=[],a=[],s=[];if(e.prop("disabled",!0),$("#ckAllVideos, #ckAllVideos1").prop("checked",!1),$("#tbVideos tbody input[type=checkbox]:checked").each((function(){t.push($(this).val())})),t.length>0){var o=function(o,n){var l,r=n+1;"fail"!==o.status?a.push(t[n]):s.push(t[n]),(l=a.length+s.length)>=t.length?(e.prop("disabled",!1),videos.reload(),s.length>0?swalInfo(a.length+" videos were successfully deleted and "+s.length+" other videos failed to be deleted."):swalSuccess("These "+l+" videos have been successfully deleted.")):i(t[r],r)},i=function(e,t){videos.delete.ajax(e,(function(e){o(e,t)}),(function(e){o({status:"fail"},t)}))};swalQuestion("Are you sure?","You will delete "+t.length+" videos. "+notRecovered(),(function(a){a?i(t[0],0):e.prop("disabled",!1)}))}else swalWarning("Please check the videos you want to delete first.")},byHost:function(){}},dmca:{ajax:function(e,t,a,s){ajaxPOST(videos.url,{id:e,action:"dmcaTakedown",takedown:t},a,s)},single:function(e,t){e.prop("disabled",!0),videos.dmca.ajax(e.data("id"),t,(function(t){"fail"!==t.status?(videos.reload(),swalSuccess(t.message)):(e.prop("disabled",!1),swalError(t.message))}),(function(t){swalError("Failed to fetch data from server! Please contact the admin."),e.prop("disabled",!1)}))},multi:function(e,t){var a=[],s=[],o=[];if(e.prop("disabled",!0),$("#ckAllVideos, #ckAllVideos1").prop("checked",!1),$("#tbVideos tbody input[type=checkbox]:checked").each((function(){a.push($(this).val())})),a.length>0){var i=1==t?"You will takedown "+a.length+" videos.":"You will cancel the takedown of "+a.length+" videos.",n=function(t,i){var n,r=i+1;"fail"!==t.status?s.push(a[i]):o.push(a[i]),(n=s.length+o.length)>=a.length?(e.prop("disabled",!1),videos.reload(),o.length>0?swalInfo(s.length+" videos have been updated successfully and . "+o.length+" other videos failed to update."):swalSuccess("These "+n+" videos have been successfully taken down.")):l(a[r],r)},l=function(e,a){videos.dmca.ajax(e,t,(function(e){n(e,a)}),(function(e){n({status:"fail"},a)}))};swalQuestion("Are you sure?",i,(function(t){t?l(a[0],0):e.prop("disabled",!1)}))}else swalWarning("Please check the videos you want to takedown first.")}},subtitles:{autocomplete:{minLength:3,source:function(e,t){$.ajax({url:videos.url,type:"POST",data:{action:"searchSubtitles",q:e.term},success:function(e){t(e)}})},select:function(e,t){}},createFormGroup:function(e,t,a,s){var o="(.srt, .vtt, .ass, .sub, .stl, .dfxp, .ttml, .sbv, .txt)",i="file"===a?"Subtitle URL":"Choose file",n="file"===a?"Upload Subtitle":"Insert URL",l="file"===a?"videos.subtitles.uploadFile($(this))":"videos.subtitles.insertURL($(this))",r="file"===a?"upload":"link",d="file"===a?`<input type="url" name="${e}" class="form-control" placeholder="${i} ${o}">`:`<div class="custom-file"><input type="file" id="sub-${s}" name="${e}" class="custom-file-input subtitle" accept=".srt, .vtt, .ass, .sub, .stl, .dfxp, .ttml, .sbv, .txt"><label class="custom-file-label" for="sub-${s}">${i} ${o}</label></div>`;return`<div class="form-group" data-index="${s}"><div class="input-group"><div class="input-group-prepend">${subtitles.html(t)}</div>${d}<div class="input-group-append"><button type="button" class="btn btn-outline-primary" data-toggle="tooltip" title="${n}" onclick="${l}" data-index="0"><i class="fas fa-${r}"></i></button><button type="button" class="btn btn-outline-danger" data-toggle="tooltip" data-index="${s}" title="Remove Subtitle" onclick="videos.subtitles.remove($(this))"><i class="fas fa-minus"></i></button></div></div></div>`},edit:function(e,t,a){var s=$("#mdEditSubtitle");s.find("#editSubId").val(e),s.find("#editSubURL").val(a),s.find("#editSubLang").val(t).trigger("change"),s.find("#editSubFile").val(""),s.find("#editSubFile").val(null),s.find('label[for="editSubFile"]').text(s.find("#editSubFile").attr("placeholder")),s.find("#editSubType").val("url"),s.find("#fgEditSubURL").removeClass("d-none"),s.find("#fgEditSubFile").addClass("d-none"),s.modal("show")},delete:function(e,t){swalQuestion("Are you sure?","Are you sure you want to delete the "+t+" subtitle?",(function(t){t&&ajaxPOST(videos.url,{action:"deleteSubtitle",id:e},(function(t){"fail"!==t.status?($('[data-sub="'+e+'"]').remove(),swalSuccess(t.message)):swalError(t.message)}),(function(e){swalError(e.responseText)}))}))},add:function(){var e=$("#subsWrapper"),t=e.find(".form-group"),a=videos.subtitles.createFormGroup("sub-url[]","lang-url[]","file",t.length);if(e.append(a),"undefined"!=typeof searchSubtitle){var s=$('input[type="url"]'),o=videos.subtitles.autocomplete;o.select=function(e,t){s.prev().find("select").val(t.item.label).trigger("change")},s.searchSubtitle(o)}loadSelect2(),loadTooltip()},uploadFile:function(e){e.closest(".form-group").replaceWith(videos.subtitles.createFormGroup("sub-file[]","lang-file[]","url",e.data("index"))),bsCustomFileInput.init(),loadSelect2(),loadTooltip()},insertURL:function(e){if(e.closest(".form-group").replaceWith(videos.subtitles.createFormGroup("sub-url[]","lang-url[]","file",e.data("index"))),"undefined"!=typeof searchSubtitle){var t=e.find('input[type="url"]'),a=videos.subtitles.autocomplete;a.select=function(e,a){t.prev().find("select").val(a.item.label)},t.searchSubtitle(a)}loadSelect2(),loadTooltip()},remove:function(e){e.closest(".form-group").remove()},get:function(e){var t=e.next(".dropdown-menu");t.hasClass("show")||ajaxPOST(videos.url,{action:"getSubtitles",id:e.data("id")},(function(a){"fail"!==a.status?(t.html(""),$.each(a.result,(function(t,a){e.next(".dropdown-menu.show").append('<a class="dropdown-item" href="'+a.url+'" target="_blank">'+a.name+"</a>")}))):swalError(a.message)}),(function(e){swalError("Failed to fetch data from server! Please contact the admin.")}))}},removePoster:function(e,t){void 0!==e&&""!==e&&(t.prop("disabled",!0),ajaxPOST(videos.url,{action:"removePoster",id:e},(function(e){"fail"!==e.status?(t.closest(".form-group").remove(),showToast(e.message,"success")):showToast(e.message,"error"),t.prop("disabled",!1)}),(function(e){showToast("Poster failed to delete. Insert a new poster if you want to replace it!","error"),t.prop("disabled",!1)})))},scrollToHosts:function(){$("#collapseSites").collapse("show"),$("html,body").animate({scrollTop:$("#collapseSites").offset().top},"slow")},rename:function(e){var t=e.data("id"),a=$("#tbVideos tr#"+t),s=e.closest(".input-group-prepend").next("input");ajaxPOST(videos.url,{id:t,name:s.val(),action:"rename"},(function(t){a.find("a.btn-cancel").trigger("click"),"fail"!==t.status?showToast(t.message,"success"):(showToast(t.message,"error"),a.find(".title").text(e.data("title")))}),(function(e){a.find("a.btn-cancel").trigger("click"),showToast(res.responseText,"error")}))},list:function(){$("#tbVideos").length&&$("#tbVideos").DataTable({ajax:adminURL+"ajax/videos-list/?status="+$_GET("status")+"&dmca="+$_GET("dmca"),serverSide:!0,columns:[{data:"id",responsivePriority:0,className:"text-center",render:function(e,t,a,s){return btnCheckbox(e,"video","#tbVideos")}},{data:"title",responsivePriority:1,render:function(e,t,a,s){var o='<img data-src="'+a.poster_url+'" class="img-thumbnail d-none" style="max-width:200px" alt="'+e+"\" onerror=\"$(this).attr('src', '"+imgCDNURL+"assets/img/notfound.jpg');\">",i='<div class="title" contentEditable="plaintext-only" data-toggle="tooltip" title="'+e+'">'+e+'</div><div class="position-absolute" style="top:0;right:0;z-index:2"><a href="javascript:void(0)" class="fas fa-square-pen fa-xl btn-rename text-primary" title="Rename"></a><a href="javascript:void(0)" class="fas fa-square-xmark fa-xl btn-cancel text-danger d-none" title="Cancel"></a></div>';return""!==a.poster&&null!==a.poster&&(i=o+i),'<div class="d-block position-relative">'+i+"</div>"}},{data:"host",className:"text-center",render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"slug"},{data:"status",className:"text-center",render:function(e,t,a,s){var o="check",i="success",n="Good";return 2==e?(o="minus",i="warning",n="Warning"):1==e&&(o="times",i="danger",n="Broken"),'<i class="fas fa-lg fa-'+o+"-circle text-"+i+' status" data-toggle="tooltip" id="status-'+a.id+'" title="'+n+'"></i>'}},{data:"dmca",className:"text-center",render:function(e,t,a,s){return 1==e?'<i class="fas fa-lg fa-ban text-danger dmca" data-toggle="tooltip" title="Takedown"></i>':""}},{data:"sub_count",className:"text-center",render:function(e,t,a,s){return parseInt(e)>0?'<div class="dropdown"><a class="btn btn-outline-primary btn-sm dropdown-toggle" href="#" role="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Subtitles" onclick="videos.subtitles.get($(this))" data-id="'+a.id+'"><i class="fas fa-lg fa-language"></i></a><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':""}},{data:"views",className:"text-right"},{data:"name"},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"updated",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){var s='<em class="fas fa-ban mr-2 me-2"></em>Takedown',o=1;return a.dmca>0&&(s='<em class="fas fa-check mr-2 me-2"></em>Cancel Takedown',o=0),'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(a.actions.embed_code)+btnEmbed(a.actions.embed)+btnDownload(a.actions.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+e)+btnDeleteItem(e,a.title)+'<button data-id="'+e+'" class="dropdown-item clear" type="button"><i class="fas fa-eraser mr-2 me-2"></i>Clear Cache</button>'+(0===uRole?'<div class="dropdown-divider"></div><button onclick="videos.dmca.single($(this), '+o+')" data-id="'+e+'" class="dropdown-item" type="button">'+s+"</button>":"")+"</div></div>"}}],columnDefs:[{orderable:!1,targets:[0,6,11]},{visible:!0,targets:[0,1,11],className:"noVis"}],order:[[9,"desc"]],drawCallback:function(){loadTooltip(),1==localStorage.getItem("showThumb")&&$("#shThumbnail").prop("checked",!0),videos.showHideThumbnail($("#shThumbnail").prop("checked")),$("#tbVideos button.alt").click((function(){videos.alternatives.get($(this))})),$("#tbVideos button.clear").click((function(){videos.cache.clear.single($(this))})),$("#tbVideos button.delete").click((function(){videos.delete.single($(this))})),$("#tbVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")})),$("#tbVideos a.btn-rename").click((function(){var e=$(this).closest(".position-absolute").prev(".title"),t=$(this).closest("td").closest("tr").attr("id");$(this).toggleClass("d-none"),$(this).next(".btn-cancel").toggleClass("d-none"),e.replaceWith('<div class="input-group input-group-sm" onclick="$(this).removeClass(\'focus\');$(this).addClass(\'focus\');$(this).css(\'min-width\', 220)"><div class="input-group-prepend"><button class="btn btn-success btn-save" type="button" style="line-height:1.4!important" onclick="videos.rename($(this))" data-id="'+t+'" data-title="'+e.text()+'" title="Update"><i class="fas fa-save"></i></button></div><input type="text" class="form-control" value="'+e.text()+'"></div>')})),$("#tbVideos a.btn-cancel").click((function(){var e=$(this).closest(".position-absolute").prev(".input-group"),t=e.find("input").val();$(this).toggleClass("d-none"),$(this).prev(".btn-rename").toggleClass("d-none"),e.replaceWith('<div class="title" contentEditable="plaintext-only" data-toggle="tooltip" title="'+t+'">'+t+"</div>"),loadTooltip()}))}})},reload:function(){$("#ckAllVideos, #ckAllVideos1").prop("checked",!1),$(".toolbar .btn-hidden").addClass("d-none"),$("#tbVideos").DataTable().ajax.reload(null,!1)},init:function(){videos.list();var e,t,a=$("#btnUploadVideo"),s=$("#importVideos");if($("#tbImportVideos").length&&(e=$("#tbImportVideos").DataTable({columns:[{data:"title",responsivePriority:0},{data:"host",className:"text-center",render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"sub_count",className:"text-center",render:function(e,t,a,s){return parseInt(e)>0?'<div class="dropdown"><a class="btn btn-outline-primary btn-sm dropdown-toggle" href="#" role="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Subtitles" onclick="videos.subtitles.get($(this))" data-id="'+a.id+'"><i class="fas fa-lg fa-language"></i></a><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':""}},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"status",className:"text-center",render:function(e,t,a,s){var o="check",i="success",n="Good";return 2==e?(o="minus",i="warning",n="Warning"):1==e&&(o="times",i="danger",n="Broken"),'<i class="fas fa-lg fa-'+o+"-circle text-"+i+' status" data-toggle="tooltip" id="status-'+a.id+'" title="'+n+'"></i>'}},{data:"actions",className:"text-center",responsivePriority:1,render:function(e,t,a){return e.hasOwnProperty("embed")?'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(e.embed_code)+btnEmbed(e.embed)+btnDownload(e.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+a.id)+btnDeleteItem(a.id,a.title)+"</div></div>":""}}],order:[[3,"desc"]],columnDefs:[{orderable:!1,targets:[2,5]},{visible:!0,targets:[0,5],className:"noVis"}],drawCallback:function(){loadTooltip(),$("#tbImportVideos button.delete").click((function(){videos.delete.single($(this)),e.row($(this).parents("tr")).remove().draw()})),$("#tbImportVideos button.alt").click((function(){videos.alternatives.get($(this))})),$("#tbImportVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")}))}})),s.on("change",(function(e){a.prop("disabled",0===e.target.files.length)})),$("#mdVideosImport").on("hidden.bs.modal",(function(t){$(t.target).find("form").get(0).reset(),a.prop("disabled",!0),e.clear().draw()})),$("#frmImportVideos").on("submit",(function(t){t.preventDefault(),t.stopPropagation();var a=new FormData(this),o=$("#btnUploadVideo"),i=$("#importPercent"),n=function(){i.addClass("d-none"),s.val(""),o.prop("disabled",!0),videos.reload()},l=function(t,a){i.removeClass("d-none"),o.prop("disabled",!0),$.ajax({type:"POST",url:videos.importUrl,cache:!1,data:"action=importProcess&file="+t+"&page="+a,beforeSend:function(){o.prop("disabled",!0)},success:function(t){"fail"!==t.status?(percent=t.result.percent,i.find(".progress-bar").css("width",percent+"%").attr("aria-valuenow",percent).text(percent+"%"),t.result.list.length>0&&e.rows.add(t.result.list).draw(!1),percent<100?l(t.result.file,a+1):(showToast(t.message,"success"),n())):(showToast(t.message,"error"),n())},error:function(){showToast("Server cannot be accessed. Please contact admin!","error"),n()}})};!1===this.checkValidity()||o.prop("disabled")?$(this).addClass("was-validated"):document.getElementById("importVideos").files.length?$.ajax({type:"POST",url:videos.importUrl,contentType:!1,processData:!1,cache:!1,data:a,beforeSend:function(){o.prop("disabled",!0)},success:function(e){"fail"!==e.status&&null!==e.result&&""!==e.result?l(e.result,0):showToast(e.message,"error")},error:function(){showToast("Server cannot be accessed. Please contact admin!","error"),o.prop("disabled",!0)}}):showToast("Insert the video file first!","error")})),$("#tbBulkVideos").length&&(t=$("#tbBulkVideos").DataTable({columns:[{data:"title",responsivePriority:0},{data:"host",className:"text-center",render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"sub_count",className:"text-center",render:function(e,t,a,s){return parseInt(e)>0?'<div class="dropdown"><a class="btn btn-outline-primary btn-sm dropdown-toggle" href="#" role="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Subtitles" onclick="videos.subtitles.get($(this))" data-id="'+a.id+'"><i class="fas fa-lg fa-language"></i></a><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':""}},{data:"added",className:"text-right",render:function(e,t,a){return formatTimestamp(e)}},{data:"status",className:"text-center",render:function(e,t,a,s){var o="check",i="success",n="Good";return 2==e?(o="minus",i="warning",n="Warning"):1==e&&(o="times",i="danger",n="Broken"),'<i class="fas fa-lg fa-'+o+"-circle text-"+i+' status" data-toggle="tooltip" id="status-'+a.id+'" title="'+n+'"></i>'}},{data:"actions",className:"text-center",responsivePriority:1,render:function(e,t,a){return e.hasOwnProperty("embed")?'<div class=""dropdown"">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(e.embed_code)+btnEmbed(e.embed)+btnDownload(e.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+a.id)+btnDeleteItem(a.id,a.title)+"</div></div>":""}}],order:[[3,"desc"]],columnDefs:[{orderable:!1,targets:[2,5]},{visible:!0,targets:[0,5],className:"noVis"}],drawCallback:function(){loadTooltip(),$("#tbBulkVideos button.delete").click((function(){videos.delete.single($(this)),t.row($(this).parents("tr")).remove().draw()})),$("#tbBulkVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")}))}})),$("#mdBulkVideo").on("hidden.bs.modal",(function(e){$(e.target).find("form").get(0).reset(),t.clear().draw()})),$("#frmBulkVideo").on("submit",(function(e){e.preventDefault(),e.stopPropagation();var a=$("#txtBulkLinks").val().trim().split("\n"),s=$("#useTitleAsSlug").prop("checked"),o=$("#btnSaveBulkVideo"),i=$("#saveBulkPercent"),n=function(e){i.removeClass("d-none"),o.prop("disabled",!0),$.ajax({type:"POST",url:"ajax/",cache:!1,data:"action=saveBulkProcess&total="+a.length+"&data="+a[e]+"&offset="+e+"&useTitle="+s+"&token="+Cookies.get("adv_token",main.cookieConfig),success:function(e){percent=parseInt(e.result.next/e.result.total*100),i.find(".progress-bar").css("width",percent+"%").attr("aria-valuenow",percent).text(percent+"%"),e.result.hasOwnProperty("data")&&t.row.add(e.result.data).draw(!1),e.result.next<e.result.total?n(e.result.next):(showToast(e.message,"success"),$("#txtBulkLinks").val(""),o.prop("disabled",!1),i.addClass("d-none"),videos.reload())},error:function(){showToast("Server cannot be accessed. Please contact admin!","error"),i.addClass("d-none"),o.prop("disabled",!1)}})};!1===this.checkValidity()||o.prop("disabled")?$(this).addClass("was-validated"):a.length?(i.find(".progress-bar").css("width","0%").attr("aria-valuenow","0").text("0%"),n(0)):showToast("Insert the video links first!","error")})),void 0!==$.ui&&$.widget("custom.searchSubtitle",$.ui.autocomplete,{_renderItem:function(e,t){return $("<li>").append('<strong>File Name: <span class="text-success">'+t.id+'</span><br>Language: <span class="text-primary">'+t.label+"</span></strong>").appendTo(e)}}),void 0!==$.fn.searchSubtitle){var o=videos.subtitles.autocomplete;o.select=function(e,t){$("#sub-lang-0").val(t.item.label)},$("#sub-url-0").searchSubtitle(o)}$("#mdEditSubtitle").detach().appendTo("body"),$("#frmEditSubtitle").on("submit",(function(e){e.preventDefault(),e.stopPropagation();var t=$("#mdEditSubtitle"),a=new FormData(this),s=$(this).find('button[type="submit"]'),o=$("#editSubType").val();!1===this.checkValidity()||s.prop("disabled")?$(this).addClass("was-validated"):document.getElementById("editSubFile").files.length>0&&"file"===o||"url"===o?$.ajax({type:"POST",url:videos.url,contentType:!1,processData:!1,cache:!1,data:a,beforeSend:function(){s.prop("disabled",!0)},complete:function(){s.prop("disabled",!1)},success:function(e){if("fail"!==e.status){var a=$('.ui-sortable-handle[data-sub="'+e.result.id+'"]'),s="videos.subtitles.edit("+e.result.id+", '"+e.result.lang+"', '"+e.result.sub+"')";a.find(".float-left a").attr("href",e.result.sub).text(e.result.lang),a.find(".float-right a:first-child").attr("onclick",s),t.modal("hide"),showToast(e.message,"success")}else showToast(e.message,"error")},error:function(){showToast("Server cannot be accessed. Please contact admin!","error"),s.prop("disabled",!1)}}):showToast("Insert the Subtitle URL/File first!","error")})),$("#mdEditSubtitle").on("hidden.bs.modal",(function(){$("#frmEditSubtitle").get(0).reset()})),$("#mdVideosExport").detach().appendTo("body"),$("#mdVideosExport").on("shown.bs.modal",(function(){showVideosExport()})),$("#mdVideosImport").detach().appendTo("body"),$("#mdBulkVideo").detach().appendTo("body"),$("#mdDelHost").detach().appendTo("body"),$("#mdDelHost").on("hidden.bs.modal",(function(){var e=$("#frmDelHost button[type=submit]");e.find(".fas").attr("class","fas fa-trash mr-2 me-2"),e.prop("disabled",!1),$(".coldelhost").removeClass("d-none"),$("#ckDelAll").prop("checked",!1),$("#ckDelHostSelected").html(""),$("#frmDelHost").get(0).reset()})),$(".ckdelhost").click((function(){var e=[],t=$("#ckDelAll");$(".ckdelhost:checked").each((function(t,a){e.push($(this).data("name"))})),e.length>0?t.prop("indeterminate",!0):t.prop("checked",!0),$("#ckDelHostSelected").html(e.join(", ").trim(", "))})),$("#ckDelAll").click((function(){$(this).prop("checked")&&($(".ckdelhost").each((function(e,t){$(t).prop("checked",!1)})),$("#ckDelHostSelected").html(""))})),$("#txtScDelHost").on("keyup blur",(function(){var e=$(this).val().toLowerCase();$(".coldelhost").each((function(){$(this).data("host").indexOf(e)<0?$(this).addClass("d-none"):$(this).removeClass("d-none")}))})),$("#frmDelHost").on("submit",(function(e){e.preventDefault(),e.stopPropagation();var t=[],a=$("#frmDelHost button[type=submit]");$(".coldelhost input[type=checkbox]:checked").each((function(){t.push($(this).val())})),!0===confirm("Are you sure?")&&ajaxPOST(videos.url,{hostnames:t,action:"deleteByHostnames"},(function(e){"fail"!==e.status?(showToast(e.message,"success"),videos.reload(),$("#mdDelHost").modal("hide")):(showToast(e.message,"error"),a.find(".fas").attr("class","fas fa-spinner fa-spin mr-2 me-2"),a.prop("disabled",!0))}),(function(e){showToast(res.responseText,"error"),$("#mdDelHost").modal("hide")}))})),$("#mdVideosRename").detach().appendTo("body"),$("#mdVideosRename").on("hidden.bs.modal",(function(){$("#frmRenameVideos").get(0).reset()})),$("#frmRenameVideos").on("submit",(function(e){e.preventDefault(),e.stopPropagation();var t=[],a=$(this).serialize();$('#tbVideos tbody tr input[type="checkbox"]:checked').each((function(){t.push($(this).val())})),a+="&ids="+t.join(","),ajaxPOST(videos.url,{data:a,action:"renameMulti"},(function(e){"fail"!==e.status?(swalSuccess(e.message),videos.reload()):swalError(e.message),$("#mdVideosRename").modal("hide")}),(function(e){showToast(e.responseText,"error")}))})),void 0!==$.fn.sortable&&($("#subtitles").sortable(),$("#altWrapper").sortable({handle:".move"})),$(".btn-upload-poster").click((function(){$("#posterUpload").toggleClass("d-none"),$("#posterURL").toggleClass("d-none")}))},showHideThumbnail:function(e){var t=$("#tbVideos img.img-thumbnail");e?(localStorage.setItem("showThumb",1),t.each((function(e){$(this).attr("src",$(this).data("src"))})),t.removeClass("d-none")):(localStorage.setItem("showThumb",0),t.addClass("d-none"))},gdrive_files:{delete:function(e){swalQuestion("Are you sure?","Delete the '"+e.data("name")+"' mirror file.",(function(t){t&&ajaxPOST(gdrive_files.url,{id:e.data("id"),action:"deleteMirror"},(function(t){"fail"!==t.status?(e.closest("li").remove(),swalSuccess(t.message)):swalError(t.message)}),(function(e){swalError(e.responseText)}))}))}},exportAsCSV:function(e){var t=[];e.prop("disabled",!0),$("#ckAllVideos, #ckAllVideos1").prop("checked",!1),$("#tbVideos tbody input[type=checkbox]:checked").each((function(){t.push($(this).val())})),t.length&&ajaxPOST(videos.exportUrl,{ids:t.join(","),action:"exportAsCSV"},(function(t){"fail"!==t.status?(window.open(t.result,"_blank"),showToast(t.message,"success")):showToast(t.message,"error"),e.prop("disabled",!1)}),(function(t){showToast(t.responseText,"error"),e.prop("disabled",!1)}))}},player={alternative:{add:function(){swal({title:"Info",text:"You can add some alternative video urls from the user page!",type:"info",showCancelButton:!0,confirmButtonClass:"btn-primary",confirmButtonText:"OK",cancelButtonClass:"btn-danger",cancelButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},(function(e){e&&(location.href=adminURL+"videos/new/")}))}},subtitle:{insert:function(e){videos.subtitles.insertURL(e)},remove:function(e){videos.subtitles.remove(e)},upload:function(e){videos.subtitles.uploadFile(e)},add:function(){var e=$("#subsWrapper"),t=e.find(".input-group");t.length<10?(e.append(videos.subtitles.createFormGroup("sub-url[]","lang-url[]","file",t.length)),loadSelect2(),loadTooltip()):swalWarning("A maximum of 10 subtitle URLs/files are allowed")}}};function checkSingle(e,t){var a=$(document).find(t),s=$(document).find(t+"_wrapper").prevAll(".toolbar").find(".btn-hidden");a.find("tbody input[type=checkbox]:checked").length?(s.removeClass("d-none"),a.find("thead input[type=checkbox], tfoot input[type=checkbox]").prop("indeterminate",!0)):(s.addClass("d-none"),a.find("input[type=checkbox]").prop("checked",!1))}function checkAll(e,t){var a=$(document).find(t),s=$(document).find(t+"_wrapper").prevAll(".toolbar").find(".btn-hidden");a.find("input[type=checkbox]").prop("checked",e.prop("checked")),a.find("tbody input[type=checkbox]:checked").length?s.removeClass("d-none"):(s.addClass("d-none"),a.find("input[type=checkbox]").prop("checked",!1))}function capitalizeWords(e){return e.replace(/\b\w/g,(function(e){return e.toUpperCase()}))}function getMonthName(e){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e]}function formatTimestamp(e){if(null!=e&&e>1e3){var t=new Date(1e3*e);return getMonthName(t.getMonth())+" "+t.getDate()+", "+t.getFullYear()+" "+t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")}return""}function gdriveViewLink(e){return'<a href="https://drive.google.com/file/d/'+e+'/view?usp=drivesdk" target="_blank">'+e+"</a>"}function updateNow(){$.ajax({url:"ajax/?action=updateNow",timeout:3e5})}function searchHost(e){$("#tbHost tbody tr").each((function(t,a){$(a).data("host").toLowerCase().indexOf(e)>-1||$(a).html().toLowerCase().indexOf(e)>-1?$(a).removeClass("d-none"):$(a).addClass("d-none")}))}function swalQuestion(e,t,a){swal({title:e,text:t,type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},a)}function swalSuccess(e){swal("Success!",e,"success")}function swalError(e){swal("Error!",e,"error")}function swalInfo(e){swal("Info!",e,"info")}function swalWarning(e){swal("Warning!",e,"warning")}function ajaxValidation(e,t){var a=document.querySelector(e);""!==t?a.setAttribute("data-error-ajax",t):a.removeAttribute("data-error-ajax"),a.setCustomValidity(t)}function matchValidation(e,t){var a=document.querySelector(e);""!==t?a.setAttribute("data-error-match",t):a.removeAttribute("data-error-match"),a.setCustomValidity(t)}function multiSelectOptions(){var e="<input type='search' class='form-control form-control-sm' autocomplete='off' placeholder='Search'>";return{keepOrder:!0,selectableHeader:e,selectionHeader:e,afterInit:function(e){var t=this,a="#"+t.$container.attr("id"),s=t.$selectableUl.prev(),o=t.$selectionUl.prev(),i=a+" .ms-elem-selectable:not(.ms-selected)",n=a+" .ms-elem-selection.ms-selected";s.on("blur keyup",(function(e){var t=$(this).val().toLowerCase();""!==t?$(i).each((function(){$(this).text().toLowerCase().indexOf(t)>-1?$(this).removeClass("d-none"):$(this).addClass("d-none")})):$(i).removeClass("d-none")})),o.on("blur keyup",(function(e){var t=$(this).val().toLowerCase();""!==t?$(n).each((function(){$(this).text().toLowerCase().indexOf(t)>-1?$(this).removeClass("d-none"):$(this).addClass("d-none")})):$(n).removeClass("d-none")}))}}}function copyText(e,t){var a=document.createElement("textarea");a.textContent=e,document.body.appendChild(a);var s=document.createRange();s.selectNode(a);var o=document.getSelection();o.removeAllRanges(),o.addRange(s),console.log("copy success",document.execCommand("copy")),o.removeAllRanges(),document.body.removeChild(a),showToast((t=void 0!==t&&""!==t&&null!==t?t:"Embed code")+" has been copied.","success")}function loadTooltip(){$('[data-toggle="tooltip"], [data-tooltip="true"]').tooltip({container:"body"}),$('[data-toggle="tooltip"], [data-tooltip="true"]').on("show.bs.tooltip",(function(){$('body > [role="tooltip"]').remove()}))}function loadSelect2(){void 0!==$.fn.select2&&$(".select2").select2({theme:"bootstrap4"})}function loadStyle(e,t){var a=document.createElement("link");a.href=e,a.type="text/css",a.rel="stylesheet",void 0!==t&&(a.onload=t),document.getElementsByTagName("head")[0].appendChild(a)}function require(e,t){var a=document.createElement("script");a.src=e,a.type="text/javascript",void 0!==t&&(a.onload=t),document.getElementsByTagName("head")[0].appendChild(a)}function $_GET(e){e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(window.location.href);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function showVideosExport(){var e,t,a=$("#tbVideos tbody input[type=checkbox]:checked"),s=$("#mdVideosExport"),o=s.find("#dl textarea"),i=s.find("#el textarea"),n=s.find("#embed textarea"),l=s.find("#bb textarea"),r=s.find("#html textarea"),d="",c="",u="",p="";s.find("textarea").val(""),a.each((function(a,f){e=$("#tbVideos tbody tr#"+$(f).val()),t=e.find(".dropdown-menu .dropdown-item"),d=t.eq(2).attr("href")+"\n\n",c=t.eq(1).attr("href")+"\n\n",p=t.eq(0).data("text")+"\n\n",u=""!==(u=e.find(".title").text())?u:"(No Title)",s.find("#show_title").prop("checked")?(o.val(o.val()+u+": "+d),i.val(i.val()+u+": "+c),n.val(n.val()+u+"\n"+p),l.val(l.val()+"[URL="+c.replace("\n\n","")+"]"+u+"[/URL]\n\n")):(o.val(o.val()+d),i.val(i.val()+c),n.val(n.val()+p),l.val(l.val()+"[URL]"+c.replace("\n\n","")+"[/URL]\n\n")),r.val(r.val()+'<a href="'+c.replace("\n\n","")+'" target="_blank">'+u+"</a>\n\n")}))}function showToast(e,t,a){var s={text:e.replace(/\+/gi," "),duration:5e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,callback:function(){Cookies.remove("adm-type",main.cookieConfig),Cookies.remove("adm-message",main.cookieConfig)}};$('body div[role="tooltip"]').remove(),"undefined"!=typeof Toastify&&Toastify(Object.assign(s,{info:{style:{background:"linear-gradient(to right, #5477f5, #73a5ff)"}},warning:{style:{background:"linear-gradient(to right, #ff9800, #ffc107)"},className:"text-dark"},danger:{style:{background:"linear-gradient(to right, #e91e63, #f44336)"}},success:{style:{background:"linear-gradient(to right, #009688, #4caf50)"}},error:{style:{background:"linear-gradient(to right, #e91e63, #f44336)"}}}[t],a)).showToast()}function ajaxGET(e,t,a){var s=!(e.indexOf("/api")>-1);$.ajax({url:e,type:"GET",cache:s,success:t,error:a})}function ajaxPOST(e,t,a,s,o){var i=!(e.indexOf("/api")>-1),n="function"==typeof a?a:function(e){},l="function"==typeof s?s:function(e){},r="function"==typeof o?o:function(e){};$.ajax({url:e,type:"POST",cache:i,data:t,beforeSend:r,success:n,error:l})}function btnCog(){return'<button type="button" class="btn btn-sm btn-custom dropdown-toggle" data-bs-toggle="dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-cog"></i></button>'}function btnDownload(e){return'<a class="dropdown-item" href="'+e+'" target="_blank"><i class="fas fa-download mr-2 me-2"></i>Download URL</a>'}function btnEmbed(e){return'<a class="dropdown-item" href="'+e+'" target="_blank"><i class="fas fa-link mr-2 me-2"></i>Embed URL</a>'}function btnEditItem(e){return'<a href="'+e+'" class="dropdown-item" type="button"><i class="fas fa-edit mr-2 me-2"></i>Edit</a>'}function btnCopyEmbed(e){return'<button class="dropdown-item copy-embed" data-text="'+e+'"><i class="fas fa-code mr-2 me-2"></i>Copy Embed Code</button>'}function btnDeleteItem(e,t){return'<button class="dropdown-item delete" data-id="'+e+'" data-name="'+t+'" type="button"><i class="fas fa-trash mr-2 me-2"></i>Delete</button>'}function notRecovered(){return"Deleted data cannot be recovered."}function btnCheckbox(e,t,a){return'<div class="custom-control custom-checkbox mx-auto"><input type="checkbox" class="custom-control-input" id="'+t+"-"+e+'" value="'+e+'" onchange="checkSingle($(this), \''+a+'\')"><label class="custom-control-label" for="'+t+"-"+e+'"></label></div>'}$(document).ready((function(e){main.init(),e("#modalExtApps").detach().appendTo("body"),e("#modalExtApps").on("hide.bs.modal",(function(){e("#hideForever").prop("checked")&&ajaxPOST(settings.url,"action=hideExtDialog",(function(e){}),(function(e){}))})),dashboard.supportChecker(),dashboard.popularVideos.list(),dashboard.recentVideos.list(),dashboard.chart.videoStatus(".video-status"),dashboard.chart.serverStatus(".server-status");var t=document.querySelector("#views > .chart");if(dashboard.chart.views.load("seven_days",0,t),e('#views input[name="options"]').click((function(){dashboard.chart.views.load(e(this).val(),0,t)})),gdrive_accounts.list(),gdrive_files.list(),gdrive_backup_files.list(),gdrive_backup_queue.list(),load_balancers.list(),void 0!==e.fn.multiSelect){var a=Object.assign(multiSelectOptions(),{selectableHeader:"<div class='header'>Enabled Hosts</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Disabled Hosts</div>"+main.multiSelectSearch});e("#disallow_hosts").multiSelect(a);var s=Object.assign(multiSelectOptions(),{selectableHeader:"<div class='header'>Allowed</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Disallowed</div>"+main.multiSelectSearch});e("#disallow_continent").multiSelect(s)}if(void 0!==e.fn.multiSelect){var o=Object.assign(multiSelectOptions(),{selectableHeader:"<div class='header'>Direct Hosts</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Bypassed Hosts</div>"+main.multiSelectSearch}),i=Object.assign(multiSelectOptions(),{selectableHeader:"<div class='header'>Enabled Hosts</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Disabled Hosts</div>"+main.multiSelectSearch}),n=Object.assign(multiSelectOptions(),{selectableHeader:"<div class='header'>Enabled Resolutions</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Disabled Resolutions</div>"+main.multiSelectSearch}),l=Object.assign(window.multiSelectOptions(),{selectableHeader:"<div class='header'>Allowed Countries</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Banned Countries</div>"+main.multiSelectSearch});e("#bypass_hosts, #bypass_host").multiSelect(o),e("#disable_host").multiSelect(i),e("#disable_resolution").multiSelect(n),e("#banned_countries").multiSelect(l)}e("#modalCustomVAST").detach().appendTo("body"),e("#frmCreateCustomVast").submit((function(t){t.preventDefault(),ajaxPOST(settings.url,e(this).serialize(),(function(t){"fail"!==t.status?(e("#txtCustomVastResult").val(t.result),swalSuccess(t.message)):swalError(t.message),e("#customVastResult").toggleClass("d-none")}),(function(e){swalError(e.responseText)}))})),e("#frmLicense").submit((function(t){t.preventDefault(),ajaxPOST(settings.url,e(this).serialize(),(function(t){e("#frmLicense")[0].remove(),swalSuccess(t.message)}),(function(e){swalError(e.responseText)}))})),e("#modalHostSub").detach().appendTo("body"),e("#mdUploadSubtitle").detach().appendTo("body"),subtitles.list(),sessions.list(),e("#modalUserStats").detach().appendTo("body"),e("#modalUserStats").on("hidden.bs.modal",(function(){e("#modalUserStats").find("#statUserID").val("")})),e("#modalUserStats").on("shown.bs.modal",(function(){var t=e("#modalUserStats #statUserID").val();users.stats.recentVideos(t),users.stats.popularVideos(t),users.stats.videosStatus(t),dashboard.chart.views.load(e('#userViews input[name="options"]:checked').val(),t,document.querySelector("#userViews > .chart"))})),e('#userViews input[name="options"]').change((function(){dashboard.chart.views.load(e(this).val(),e("#modalUserStats #statUserID").val(),document.querySelector("#userViews > .chart"))})),users.list();var r=e("#frmUser #retype_password"),d=e("#frmUser #password");if(d.change((function(){""!==e(this).val()?(e(this).prop("required",!0),r.prop("required",!0)):(e(this).prop("required",!1),r.prop("required",!1))})),r.change((function(){var t="#frmUser #retype_password";e(this).val()!==d.val()?matchValidation(t,"The confirm new password must be the same as the new password"):matchValidation(t,"")})),videos.init(),e("#frmCreatePlayer").on("submit",(function(t){t.preventDefault();var a=e("#g-recaptcha-response"),s=function(){var t=e("#frmCreatePlayer"),a=e("#createPlayerResult"),s=t.find("#submit"),o=new FormData(t[0]),i=s.html();s.html(main.spinner).prop("disabled",!0),a.addClass("d-none"),e("#embedIframe").attr("src",""),o.append("action","createPlayer"),e.ajax({type:"POST",url:"ajax/",contentType:!1,processData:!1,cache:!1,data:o,success:function(t){"fail"!==t.status?(e("#txtEmbed").val(t.result.embed_url),e("#txtEmbedCode").val(t.result.embed_code),e("#txtDl").val(t.result.download_url),e("#txtReq").val(t.result.request_url),e("#embedIframe").attr("src",t.result.embed_url),a.removeClass("d-none")):swalError(t.message)},error:function(e){swalError(e.responseText)},complete:function(){t[0].reset(),s.html(i).prop("disabled",!1),"recaptchaReset"in window&&recaptchaReset()}})};if(a.length&&!window.sStorage.getItem("g-recaptcha-response"))return"recaptchaReset"in window&&recaptchaReset(),swalQuestion("Info","The security code has expired. Please try again",(function(e){e&&s()})),!1;s()})),e("#frmBypassLimit").on("submit",(function(t){t.preventDefault();var a=e("#g-recaptcha-response"),s=function(){var t=e("#frmBypassLimit"),a=e("#txtGDriveDL"),s=t.find("#submit"),o=s.html();e.ajax({url:"ajax/",method:"POST",dataType:"json",cache:!1,data:t.serialize(),beforeSend:function(){s.html(main.spinner).prop("disabled",!0),a.attr("data-id","")},success:function(e){"fail"!==e.status?(a.attr("data-id",e.result.id).val(e.result.link),swalSuccess(e.message)):swalError(e.message)},error:function(e){swalError(e.responseText)},complete:function(){s.html(o).prop("disabled",!1),"recaptchaReset"in window&&recaptchaReset()}})};if(a.length&&!window.sStorage.getItem("g-recaptcha-response"))return"recaptchaReset"in window&&recaptchaReset(),swalQuestion("Info","The security code has expired. Please try again",(function(e){e&&s()})),!1;s()})),"undefined"!=typeof oldDBVersion&&"undefined"!=typeof newDBVersion&&oldDBVersion!==newDBVersion){var c=function(){e.ajax({url:adminURL+"ajax/?action=updateChecker",cache:!1,success:function(t){var a,s=0,o=(0==(a=e("body").find("#updateModal")).length&&(e("body").append('<div class="modal" id="updateModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="updateModalLabel">Update Progress</h5></div><div class="modal-body"><p>Progressed Number: <span id="updateNumber">0</span> of <span id="updateTotal">0</span></p></p><div class="progress" style="height:20px"><div id="updateProgress" class="progress-bar" role="progressbar" style="width:0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="0">0%</div></div></div></div></div></div>'),a.on("hidden.bs.modal",(function(){a.remove()}))),a);"fail"!==t.status&&(o.modal("show"),s=parseInt(t.result.number/t.result.total*100),0===t.result.number&&updateNow(),s+="%",o.find("#updateProgress").attr("aria-valuemax",t.result.total),o.find("#updateNumber").text(t.result.number),o.find("#updateTotal").text(t.result.total),o.find("#updateProgress").attr("aria-valuenow",t.result.number).css("width",s).text(s),t.result.number>0&&t.result.number>=t.result.total?o.modal("hide"):c())}})};c()}})),function(){"use strict";window.addEventListener("load",(function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,(function(e,t){e.addEventListener("submit",(function(a){!1===e.checkValidity()&&(a.preventDefault(),a.stopPropagation()),e.classList.add("was-validated"),function(e,t){var a=function(e,a,s){var o=s.html();s.html("<span id='error-"+t+"-"+e+"'>"+o+(""!==o?"<br>":"")+a+"</span>")};e.length&&$.each(e,(function(e,s){var o=$(this),i=o.next(".invalid-feedback"),n=o.val(),l=o.attr("min"),r=o.attr("max"),d=new RegExp(o.attr("pattern")),c="span#error-"+t+"-"+e+"-";0===i.length&&(i=o.closest(".input-group").find(".invalid-feedback")),o.is(":invalid")&&(i.html(""),$.each(s.dataset,(function(t,s){"Required"===(t=t.replace("error",""))&&(""===n?a(t+"-"+e,s,i):$(c+t).remove()),"Min"===t&&("number"!=typeof l||parseFloat(n)<parseFloat(l)?a(t+"-"+e,s,i):$(c+t).remove()),"Max"===t&&("number"!=typeof r||parseFloat(n)>parseFloat(r)?a(t+"-"+e,s,i):$(c+t).remove()),"Pattern"===t&&(d.test(n)?$(c+t).remove():a(t+"-"+e,s,i)),"Ajax"===t&&(""!==s?a(t+"-"+e,s,i):$(c+t).remove()),"Match"===t&&(""!==s?a(t+"-"+e,s,i):$(c+t).remove())})))}))}(e.elements,t)}),!1)}))}),!1)}();