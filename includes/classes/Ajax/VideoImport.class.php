<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.16  |
    |              on 2025-05-18 20:27:33              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
/*
Copyright @ 2020 - 2025 GDPlayer v4.7.1. https://gdplayer.to | https://t.me/gdplayerto
*/
 namespace GDPlayer\Ajax; use GDPlayer\{Config, Helper, ImportCSV}; class VideoImport extends \GDPlayer\Ajax\Video { protected ImportCSV $csv; protected $importDir = ''; protected $perPage = 10; protected const MESSAGE_VIDEO_IMPORT_SUCCESS = "\124\x68\x65\40\x6e\x65\167\x20\x76\151\x64\x65\x6f\40\x6c\x69\163\164\x20\150\x61\x73\40\142\x65\145\156\x20\163\165\143\x63\145\163\x73\146\165\154\154\x79\x20\151\x6d\160\x6f\x72\x74\145\144"; protected const MESSAGE_VIDEO_IMPORT_FAIL = "\116\x65\167\x20\x76\x69\x64\x65\x6f\x20\154\151\163\164\40\146\x61\x69\154\x65\144\x20\164\157\40\x69\155\160\x6f\x72\x74"; public function __construct() { goto wS51o; wS51o: session_write_close(); goto wEOJk; wEOJk: $this->data = array_merge($_POST, $_GET); goto jUytj; mcr5l: $this->loadData(); goto GeLmL; GeLmL: $this->csv = new ImportCSV(); goto vfPpB; vfPpB: $this->importDir = UPLOADS_PATH . "\x69\155\160\157\162\x74\x2f"; goto yWZI0; fpsfl: parent::__construct(); goto kCx3z; yWZI0: $this->perPage = intval(Config::get("\x69\155\x70\157\x72\164\137\x6f\x66\146\x73\145\164") ?? 10); goto fpsfl; jUytj: $this->files = $_FILES; goto mcr5l; kCx3z: } public function response() { session_write_close(); return $this->defaultResponse($this); } private function importAlternativeVideos(int $vid = 0, array $urls = []) { goto g2zv2; g2zv2: session_write_close(); goto gRNdL; dm0nd: COCKH: goto snL2q; snL2q: return $result; goto k6svK; nN_0q: foreach ($urls as $i => $url) { goto ux0dU; ZVHdg: $result += 1; goto cjUjp; ux0dU: $this->hosting->setURL($url); goto rKGty; cjUjp: FamHM: goto zH8qD; zH8qD: brrYH: goto VqlP9; Xbh33: if (!$altSaved) { goto FamHM; } goto ZVHdg; rKGty: $altSaved = $this->vAlt->insert(["\x76\151\144" => $vid, "\150\157\x73\164" => $this->hosting->getHost(), "\x68\157\163\164\x5f\x69\144" => $this->hosting->getID(), "\x6f\162\x64\145\162" => $i]); goto Xbh33; VqlP9: } goto dm0nd; gRNdL: $result = 0; goto nN_0q; k6svK: } private function importSubtitleUrls(int $vid = 0, array $labels = [], array $urls = []) { goto VbFlr; ui_Ey: yStRo: goto fEdbG; VF9vy: foreach ($urls as $i => $url) { goto T38yt; Mj1Ww: iSFcA: goto OI3Fw; o5M_9: $result += 1; goto Mj1Ww; T38yt: $subSaved = $this->sub->insert(["\154\x61\x6e\x67\x75\141\147\x65" => $labels[$i] ?? '', "\154\151\x6e\153" => $url, "\166\151\144" => $vid, "\x61\x64\144\145\x64" => $time, "\x75\x70\x64\141\164\x65\x64" => $time, "\165\x69\x64" => $this->currentUser["\151\x64"], "\x6f\162\144\145\x72" => $i]); goto v4kms; OI3Fw: PY96w: goto sUslY; v4kms: if (!$subSaved) { goto iSFcA; } goto o5M_9; sUslY: } goto ui_Ey; MItje: $time = time(); goto VF9vy; VbFlr: session_write_close(); goto aKpoF; aKpoF: $result = 0; goto MItje; fEdbG: return $result; goto DiTgP; DiTgP: } private function importSubtitleJson(int $vid = 0, string $url = '') { goto aLuib; Ifs_N: goto twnuM; goto Gh4Ze; ET2NV: if ($status === 200) { goto No0SM; } goto Z9ovA; hlW89: $err = curl_error($ch); goto Yt70Q; Z9ovA: createErrorLog([__FILE__, __FUNCTION__, $url, $status, $err]); goto Ifs_N; xYEzu: $result = 0; goto daRvM; aLuib: session_write_close(); goto xYEzu; Gh4Ze: No0SM: goto viMD2; r8xP5: $response = curl_exec($ch); goto M30RU; M30RU: $status = curl_getinfo($ch, CURLINFO_RESPONSE_CODE); goto hlW89; ytLgk: curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "\107\x45\x54"); goto GIV5K; h7h20: curl_setopt($ch, CURLOPT_URL, $url); goto ytLgk; GIV5K: curl_setopt($ch, CURLOPT_USERAGENT, USER_AGENT); goto r8xP5; daRvM: $time = time(); goto EvMx8; XNfZ6: if (empty($subtitles)) { goto ccH1F; } goto SEJ4i; Yt70Q: curl_close($ch); goto ET2NV; viMD2: $subtitles = @json_decode($response, true); goto XNfZ6; EvMx8: $ch = Helper::getCurlDefaultConfig(curl_init()); goto h7h20; suL9R: return $result; goto fSKdP; JNF4_: DwI0r: goto DioBB; cwhOx: twnuM: goto suL9R; DioBB: ccH1F: goto cwhOx; SEJ4i: foreach ($subtitles as $i => $sub) { goto MtV4z; rewDn: pdpj_: goto e97uh; Eq4jv: $result += 1; goto ppP_x; ppP_x: XepJZ: goto rewDn; MtV4z: $subSaved = $this->sub->insert(["\154\141\156\147\x75\141\147\145" => $sub["\x6c\141\142\145\x6c"], "\x6c\x69\x6e\153" => $sub["\x66\x69\154\x65"], "\x76\151\x64" => $vid, "\141\144\x64\145\144" => $time, "\x75\160\144\141\164\145\144" => $time, "\165\x69\144" => $this->currentUser["\151\144"], "\x6f\x72\144\145\162" => $i]); goto RoqtO; RoqtO: if (!$subSaved) { goto XepJZ; } goto Eq4jv; e97uh: } goto JNF4_; fSKdP: } private function importParser(array $newData = [], int $time = 0) { goto l0E4U; dv5GB: $d = Config::get("\x73\x6c\165\147\x5f\x64\157\x77\156\x6c\x6f\141\x64") ?? "\x64"; goto bRpAD; SON6h: $this->hosting->setHost($result["\x68\157\x73\x74"]); goto giQRH; k5P_m: $result["\x73\x74\x61\x74\165\x73"] = 0; goto JwVv0; yIsM2: goto M9bcj; goto GEEax; l0E4U: session_write_close(); goto EC9QZ; WC8JM: $result["\x68\x6f\163\x74"] = $host; goto JFjLQ; I1wJD: $embed = Config::get("\155\141\x69\156\137\x73\x69\x74\145") . $e . SLASH . $result["\x73\x6c\165\x67"]; goto s67NJ; JFjLQ: $result["\150\157\163\x74\x5f\x69\144"] = $hostId; goto T2o70; imaLv: if (!empty($newData["\166\x69\144\x65\x6f\x5f\x75\x72\x6c"])) { goto EBtRt; } goto pBwec; TB2dt: if (empty($newData["\163\165\142\164\151\164\154\x65\x5f\165\x72\x6c"])) { goto Un0nd; } goto Ew40w; AsZ7E: if (empty($newData["\x73\x75\142\x74\x69\164\154\145\x5f\x6a\x73\x6f\156"])) { goto kIcWu; } goto KysBw; bRpAD: $iframe = strtr(Config::get("\151\146\x72\141\x6d\145\x5f\x63\x6f\x64\145") ?? "\x3c\x69\x66\x72\141\155\145\x20\146\162\141\155\145\142\x6f\162\x64\145\x72\x3d\42\x30\x22\40\167\x69\x64\x74\150\75\x22\x36\x34\60\42\40\150\x65\151\x67\150\x74\x3d\42\x33\x32\x30\x22\x20\163\162\x63\75\x22\45\x73\x22\40\x61\x6c\x6c\x6f\167\146\165\x6c\154\x73\143\x72\145\x65\x6e\x3e\74\57\x69\146\162\x61\155\145\x3e", ["\173\x65\x6d\142\145\144\x5f\165\x72\154\x7d" => "\x25\163"]); goto I1wJD; wNL6H: $firstVideo = $newData["\x76\x69\144\x65\x6f\x5f\165\x72\154"][0]; goto SJUlM; GEEax: EBtRt: goto RaQZ7; VS_q8: $e = Config::get("\163\154\x75\147\x5f\x65\155\x62\x65\144") ?? "\x65"; goto dv5GB; nxEMe: Un0nd: goto AsZ7E; omEv9: $result["\x70\x6f\x73\x74\145\162"] = $newData["\160\x6f\163\164\x65\x72"] ?? ''; goto m4yW_; JwVv0: return $result; goto tzSlp; XlPhN: M9bcj: goto SON6h; EC9QZ: $result = []; goto WeVrM; HSlzl: $hostId = $this->hosting->getID(); goto WC8JM; s67NJ: $result["\141\143\x74\x69\x6f\x6e\x73"] = ["\145\155\x62\145\144" => $embed, "\x64\157\167\156\154\x6f\141\x64" => Config::get("\x6d\x61\151\156\137\x73\151\164\x65") . $d . SLASH . $result["\x73\154\165\147"], "\145\155\x62\145\x64\x5f\x63\x6f\x64\145" => sanitizeHtml(sprintf($iframe, $embed))]; goto HHHHH; HHHHH: $result["\151\144"] = $vid; goto k5P_m; aCrt5: $host = $this->hosting->getHost(); goto HSlzl; JmB_x: $result["\163\x75\142\137\x63\x6f\165\x6e\x74"] = 0; goto ChOoH; RaQZ7: $result["\141\154\164\137\x63\157\165\x6e\164"] += $this->importAlternativeVideos($vid, $newData["\x76\151\144\x65\x6f\137\165\162\154"]); goto XlPhN; M4QDe: kIcWu: goto VS_q8; W35aK: $result["\154\151\156\x6b"] = $this->hosting->getDownloadLink(); goto TB2dt; MNO_9: WCyYm: goto h3mLA; d5Qrs: $result["\141\144\144\x65\144"] = $time; goto ldKvm; cz5iJ: $slug = !empty($newData["\x73\x6c\x75\x67"]) ? slugify(trim($newData["\x73\154\165\147"])) : createSlug(5, randomString(5)); goto Z55eg; K9k0H: qoHeq: goto E111j; giQRH: $this->hosting->setID($result["\150\157\x73\164\137\x69\x64"]); goto W35aK; ldKvm: $result["\141\154\164\137\x63\157\x75\x6e\164"] = 0; goto JmB_x; WNFbU: $this->hosting->setURL($firstVideo); goto aCrt5; T2o70: $vid = $this->videos->insert(["\x74\x69\x74\x6c\145" => $result["\x74\151\x74\x6c\x65"], "\x70\157\x73\x74\x65\162" => $result["\160\x6f\x73\x74\x65\x72"], "\150\157\163\164" => $host, "\150\157\163\164\137\151\144" => $hostId, "\165\x69\144" => $this->currentUser["\x69\x64"], "\141\x64\x64\x65\x64" => $time, "\165\160\x64\141\x74\x65\x64" => $time, "\x73\154\165\147" => $slug]); goto MNO_9; KysBw: $result["\x73\x75\142\137\x63\157\165\156\164"] += $this->importSubtitleJson($vid, $newData["\163\165\x62\x74\151\164\154\x65\x5f\x6a\163\x6f\x6e"]); goto M4QDe; SJUlM: array_shift($newData["\166\x69\x64\145\x6f\x5f\165\x72\154"]); goto WNFbU; TzOL9: $result["\150\x6f\163\164\137\151\x64"] = ''; goto omEv9; ChOoH: $result["\x68\x6f\x73\x74"] = ''; goto TzOL9; brcrJ: $result["\163\x74\141\164\165\x73"] = 1; goto cz5iJ; RjHSW: $result["\x61\143\x74\x69\x6f\156\x73"] = []; goto d5Qrs; h3mLA: if (!is_numeric($vid) || empty($vid)) { goto qoHeq; } goto imaLv; pBwec: goto M9bcj; goto K9k0H; WeVrM: $vid = 0; goto rdG9_; Z55eg: if (empty($newData["\x76\x69\x64\145\x6f\x5f\x75\162\154"])) { goto WCyYm; } goto wNL6H; rdG9_: $result["\x69\x64"] = ''; goto RjHSW; E111j: return $result; goto yIsM2; m4yW_: $result["\164\151\x74\154\145"] = $newData["\164\x69\x74\x6c\x65"] ?? ''; goto brcrJ; Ew40w: $result["\163\165\142\x5f\x63\x6f\165\x6e\x74"] += $this->importSubtitleUrls($vid, $newData["\163\x75\142\x74\151\x74\154\x65\x5f\x6c\141\x62\145\x6c"], $newData["\x73\165\142\164\x69\x74\x6c\x65\137\165\x72\x6c"]); goto nxEMe; tzSlp: } protected function importProcess() { goto uDZ9g; JNRBm: $fname = basename($this->data["\146\x69\154\145"]); goto sCc10; KV04a: return $result; goto qfJ86; uDZ9g: session_write_close(); goto kyI0I; KoUOv: if (!file_exists($file)) { goto oni1c; } goto O21Db; ePf7_: $offsetRows = $page * $this->perPage; goto VNhff; kyI0I: $result = $this->toJson(0, self::MESSAGE_VIDEO_IMPORT_FAIL); goto K0C_u; O21Db: $this->csv->open($file); goto vcaOs; S5Gw8: goto AereG; goto uwEBe; end5H: $page = intval($this->data["\160\141\147\x65"]); goto ePf7_; hKWqf: $percent = 100; goto PnFVq; A0LQ3: FbecH: goto LPQEQ; K0C_u: if (!(!empty($this->data["\x66\x69\x6c\x65"]) && isset($this->data["\160\141\147\x65"]))) { goto g5D9i; } goto end5H; m8sDp: if ($totalRows < $this->perPage || $totalRows >= $offsetRows + $this->perPage) { goto fkpZ8; } goto jNSIz; uwEBe: fkpZ8: goto hKWqf; LPQEQ: oni1c: goto m8sDp; RGF4I: AereG: goto kUk4P; N1jrQ: $list = []; goto JNRBm; VNhff: $totalRows = 0; goto VdBqt; VdBqt: $percent = 0; goto N1jrQ; OrR2D: $rows = $this->csv->getRowsWithHeader($offsetRows, $this->perPage); goto bqkCk; sCc10: $file = $this->importDir . $fname; goto KoUOv; vcaOs: $totalRows = $this->csv->getTotalRows(); goto OrR2D; PnFVq: @unlink($file); goto RGF4I; bqkCk: foreach ($rows as $row) { goto ksuM7; ksuM7: if (empty($row["\166\x69\144\x65\x6f\137\165\162\154"][0])) { goto PcwaH; } goto viTnc; K3sG9: PcwaH: goto OH0nq; OH0nq: HCmXn: goto cuzVB; viTnc: $list[] = $this->importParser($row, time()); goto K3sG9; cuzVB: } goto A0LQ3; jNSIz: $percent = intval($offsetRows / $totalRows * 100); goto S5Gw8; kUk4P: $result = $this->toJson(1, self::MESSAGE_VIDEO_IMPORT_SUCCESS, ["\x6c\151\163\x74" => $list, "\146\151\154\145" => $fname, "\157\146\146\x73\145\164\122\x6f\x77\163" => $offsetRows, "\164\x6f\x74\x61\x6c\122\x6f\167\x73" => $totalRows, "\160\x65\162\143\x65\x6e\164" => $percent]); goto CSojX; CSojX: g5D9i: goto KV04a; qfJ86: } protected function importVideos() { goto nsOYk; nsOYk: session_write_close(); goto qUrlY; nHsc4: $uploaded = move_uploaded_file($this->files["\x69\x6d\160\157\162\x74\x56\151\x64\x65\157\163"]["\x74\155\160\x5f\156\x61\x6d\x65"], $file); goto juWhO; z5ck5: return $result; goto WLjZu; eVyeB: $file = $this->importDir . $this->currentUser["\x69\144"] . "\x2d" . randomString(6) . "\x2d" . basename($this->files["\151\155\160\x6f\x72\164\x56\151\x64\145\157\x73"]["\156\141\x6d\x65"]); goto nHsc4; gbGM_: dDgzj: goto dkPag; dkPag: LuPuv: goto z5ck5; EeEIs: $result = $this->toJson(1, self::MESSAGE_VIDEO_IMPORT_SUCCESS, basename($file)); goto gbGM_; lOMnv: $maxFilesize = KILOBYTES * intval(Config::get("\151\x6d\160\x6f\x72\164\137\x66\151\x6c\145\x73\151\x7a\x65") ?? 1024); goto IV50e; juWhO: if (!$uploaded) { goto dDgzj; } goto EeEIs; BkykZ: createDir($this->importDir); goto eVyeB; IV50e: if (!(!empty($this->files["\151\155\160\x6f\x72\164\126\x69\x64\x65\157\163"]) && $this->files["\x69\x6d\160\x6f\x72\x74\126\x69\x64\x65\x6f\x73"]["\x65\x72\162\157\162"] === 0 && strpos($this->files["\x69\x6d\160\x6f\x72\x74\126\151\x64\145\157\163"]["\164\171\160\x65"], "\143\163\x76") !== false && $this->files["\151\155\160\x6f\162\x74\x56\151\x64\145\157\163"]["\163\151\x7a\x65"] < $maxFilesize)) { goto LuPuv; } goto BkykZ; qUrlY: $result = $this->toJson(0, self::MESSAGE_VIDEO_IMPORT_FAIL); goto lOMnv; WLjZu: } }
