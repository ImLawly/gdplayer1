<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.16  |
    |              on 2025-05-18 20:27:33              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
/*
Copyright @ 2020 - 2025 GDPlayer v4.7.1. https://gdplayer.to | https://t.me/gdplayerto
*/
 namespace GDPlayer\Ajax; use GDPlayer\Model\{Subtitle as mSubtitle, SubtitleManager, ViewSubtitleManager}; class Subtitle extends \GDPlayer\Ajax { protected mSubtitle $sub; protected SubtitleManager $subMan; protected ViewSubtitleManager $vwSubMan; protected $listColumns = ["\x69\x64", "\x66\151\x6c\145\137\156\x61\155\145", "\154\x61\156\x67\x75\141\147\145", "\x6e\141\155\145", "\x68\157\163\164", "\141\x64\x64\145\x64", "\x75\x70\144\141\x74\145\x64", "\x69\x64"]; protected const MESSAGE_NOT_FOUND = "\124\150\x65\x20\x73\x75\142\x74\151\164\x6c\x65\x20\x77\x61\x73\x20\156\x6f\x74\x20\x66\x6f\165\156\x64"; protected const MESSAGE_DELETE_SUCCESS = "\x54\150\x65\x20\163\x75\x62\164\151\164\154\x65\40\x66\151\x6c\145\40\150\141\x73\40\x62\145\145\156\40\163\x75\143\x63\145\163\x73\146\x75\154\x6c\x79\40\144\x65\154\145\164\145\x64"; protected const MESSAGE_DELETE_FAIL = "\124\150\x65\40\x73\165\x62\x74\151\164\x6c\145\x20\146\151\154\145\x20\146\x61\151\154\145\x64\40\x74\x6f\x20\144\x65\154\145\164\145"; protected const MESSAGE_OLD_LOCATION_EMPTY = "\117\x6c\x64\x20\154\x6f\x63\x61\x74\151\x6f\x6e\40\x72\x65\161\165\x69\162\x65\x64"; protected const MESSAGE_NEW_LOCATION_INVALID = "\x54\150\145\40\156\145\167\40\x6c\157\143\x61\164\151\x6f\x6e\40\x69\x73\40\x69\x6e\x76\141\x6c\x69\x64"; protected const MESSAGE_MIGRATE_SUCCESS = "\115\151\x67\162\141\x74\151\x6f\156\x20\157\146\x20\x74\x68\145\40\163\x75\x62\164\151\164\154\145\40\x66\151\x6c\145\x73\40\x68\141\x73\40\x62\145\x65\x6e\x20\x73\x75\143\x63\x65\163\x73\x66\x75\x6c"; protected const MESSAGE_MIGRATE_FAIL = "\115\x69\147\x72\x61\x74\151\157\156\x20\157\146\x20\x74\150\x6f\x73\145\40\163\165\x62\164\x69\164\x6c\x65\40\x66\x69\154\x65\x73\x20\146\x61\x69\x6c\145\144"; protected const MESSAGE_FILE_UPLOAD_SUCCESS = "\124\x68\145\40\x73\165\x62\x74\x69\164\154\145\40\x66\x69\x6c\x65\x20\x68\141\163\40\142\145\145\156\x20\165\160\x6c\x6f\141\x64\x65\144\40\163\165\x63\x63\145\x73\x73\146\165\x6c\154\171"; protected const MESSAGE_FILE_UPLOAD_FAIL = "\x54\x68\145\x20\x73\x75\142\164\151\x74\x6c\x65\40\x66\151\x6c\145\40\146\141\x69\154\145\144\x20\x74\157\40\165\x70\x6c\157\x61\x64"; protected const MESSAGE_RENAME_SUCCESS = "\124\x68\x65\x20\163\x75\x62\x74\x69\164\x6c\x65\40\150\x61\x73\40\x62\145\145\156\40\163\165\143\143\145\163\163\x66\x75\154\154\171\x20\162\x65\x6e\141\x6d\145\x64"; protected const MESSAGE_RENAME_DUPLICATED = "\x54\x68\x65\x20\146\x69\x6c\x65\x6e\141\x6d\145\x20\151\x73\40\141\x6c\162\x65\141\144\171\x20\x69\156\40\x75\x73\x65"; protected const MESSAGE_RENAME_FAIL = "\x54\x68\x65\x20\163\x75\x62\164\151\x74\154\145\40\x66\x61\x69\x6c\145\144\x20\164\157\x20\x62\145\x20\x72\145\156\141\x6d\x65\144"; public function __construct() { goto jyljS; cvSxm: $this->sub = mSubtitle::getInstance(); goto mOLHl; OkSv4: $this->data = array_merge($_POST, $_GET); goto qfBTw; Lgn7S: $this->loadData(); goto cvSxm; mOLHl: $this->subMan = SubtitleManager::getInstance(); goto tWc6v; tWc6v: $this->vwSubMan = ViewSubtitleManager::getInstance(); goto U2wkT; jyljS: session_write_close(); goto OkSv4; qfBTw: $this->files = $_FILES; goto Lgn7S; U2wkT: } protected function createUserCriteria(string $userSep = '') { goto w5DRu; M6pTi: if ($this->isAdmin) { goto S9V2S; } goto zPzoC; kJaPU: vBbna: goto iUFji; buebW: goto Jos1r; goto RYb0L; zPzoC: $this->vwSubMan->setCriteria("\x75\151\144", $this->currentUser["\151\x64"], "\x3d", $userSep); goto buebW; RYb0L: S9V2S: goto PqWDt; w5DRu: session_write_close(); goto M6pTi; PqWDt: if (empty($this->data["\x75\x69\x64"])) { goto vBbna; } goto JcgxR; iUFji: Jos1r: goto UxrCm; JcgxR: $this->vwSubMan->setCriteria("\165\151\x64", $this->data["\165\x69\144"], "\75", $userSep); goto kJaPU; UxrCm: } protected function createSearchQuery(string $search = '') { goto uK0ae; KiQ8L: $userSep = "\x41\x4e\104"; goto okt2S; vrvei: PE8DZ: goto NEnaI; Udchd: $like = "\114\111\x4b\x45"; goto R1eL6; okt2S: $firstSep = !$this->isAdmin ? "\x28" : ''; goto YVEYF; NEnaI: $this->createUserCriteria($userSep); goto KAq36; yrArr: $this->vwSubMan->setMultiCriteria([["\x66\151\154\x65\137\156\x61\155\145", $search, $like, $firstSep], ["\154\141\x6e\x67\x75\x61\147\145", $search, $like, $or], ["\150\157\x73\x74", $search, $like, $or], ["\x6e\141\x6d\145", $search, $like, $or]]); goto ZlqVz; ZlqVz: $userSep = "\51\x20\101\x4e\104"; goto vrvei; R1eL6: $or = "\x4f\x52"; goto yrArr; uK0ae: session_write_close(); goto KiQ8L; NpmLx: $search = "\45" . $search . "\x25"; goto Udchd; YVEYF: if (empty($search)) { goto PE8DZ; } goto NpmLx; KAq36: } public function list() { goto uv5vo; PK75p: $result = $this->toDataTablesJson(); goto YiOag; yHYXI: $this->createSearchQuery($qry["\163\x65\141\x72\x63\x68"]); goto Pglwh; loJod: $this->createUserCriteria(); goto fq64T; MeUK7: $this->vwSubMan->setOrderBy($qry["\x6f\162\x64\x65\x72\102\171"], $qry["\157\x72\144\x65\162\104\151\x72"]); goto e2d3w; mErwG: DviHJ: goto iGn0X; iGn0X: $this->createSearchQuery($qry["\163\145\x61\x72\x63\x68"]); goto Hrv1h; YiOag: KYuMg: goto YUVpV; e2d3w: $list = $this->vwSubMan->get(); goto sp0Oy; B8iwh: $data = []; goto yHYXI; Pglwh: $this->vwSubMan->setLimit($qry["\x73\164\141\x72\x74"], $qry["\x6c\x65\156\x67\x74\x68"]); goto MeUK7; Hrv1h: $recordsFiltered = $this->vwSubMan->getNumRows(); goto loJod; fq64T: $recordsTotal = $this->vwSubMan->getNumRows(); goto G5KFN; hoNzW: gA8uB: goto mErwG; EGIgt: x_gfo: goto PK75p; sp0Oy: if (!$list) { goto DviHJ; } goto aHQUF; uv5vo: session_write_close(); goto Rqnkm; vMSFr: goto KYuMg; goto EGIgt; vSJqj: $qry = $this->extractDatatablesQry($this->data, $this->listColumns, "\165\x70\144\x61\x74\145\x64", "\x64\145\163\x63"); goto B8iwh; aHQUF: foreach ($list as $dt) { goto vgDrm; jNTdw: $newData["\x61\x63\164\151\157\156\163"] = $dt["\151\x64"]; goto iFhiD; xIUOm: $newData["\x68\x6f\163\164"] = validateUrl($dt["\150\157\x73\x74"]) ? $dt["\x68\x6f\163\x74"] : BASE_URL; goto I5UoK; I5UoK: $newData["\154\151\156\x6b"] = rtrim($newData["\x68\157\x73\x74"], SLASH) . "\57\x75\160\x6c\x6f\x61\x64\163\x2f\x73\165\x62\164\x69\x74\x6c\145\x73\x2f" . $dt["\x66\151\154\145\x5f\156\x61\x6d\x65"]; goto jNTdw; aTO6g: G98tC: goto Wb70R; iFhiD: $data[] = $newData; goto aTO6g; O2f7S: $newData["\x44\124\x5f\x52\157\x77\111\x64"] = $dt["\x69\x64"]; goto xIUOm; vgDrm: $newData = $dt; goto O2f7S; Wb70R: } goto hoNzW; Rqnkm: if (!$this->currentUser) { goto x_gfo; } goto vSJqj; YUVpV: return $this->createJsonResponse($result); goto CK7I_; G5KFN: $result = $this->toDataTablesJson(intval($qry["\144\x72\x61\167"]), $data, $recordsTotal, $recordsFiltered); goto vMSFr; CK7I_: } public function response() { session_write_close(); return $this->defaultResponse($this); } protected function rename() { goto Yhi_M; Yhi_M: session_write_close(); goto I7SrG; jPR6m: $result = $this->toJson(1, self::MESSAGE_RENAME_SUCCESS); goto jB3R4; FDl01: $this->tableValidation($this->data["\151\144"], "\151\144", $this->subMan); goto hR5v3; JTm2C: if (!(!empty($this->data["\x69\144"]) && !empty($this->data["\156\x61\155\x65"]))) { goto iG_xm; } goto FDl01; XvGpL: $oldFile = SUBTITLES_PATH . $oldFilename; goto bH6VH; WIqHF: DvLbZ: goto O5qYk; a990W: goto LYYFD; goto WvXpf; WvXpf: JeOGm: goto fLm1e; adLbp: if (file_exists($oldFile)) { goto DvLbZ; } goto a990W; HXZGk: if (file_exists($newFile)) { goto JeOGm; } goto adLbp; T6RZP: $this->tableValidation($this->data["\151\x64"], "\151\144", $this->subMan); goto ZY7s6; fLm1e: $result = $this->toJson(0, self::MESSAGE_RENAME_DUPLICATED); goto B6U8M; I7SrG: $result = $this->toJson(0, self::MESSAGE_NOT_FOUND); goto JTm2C; j9V1X: LYYFD: goto NGve3; O5qYk: $result = $this->toJson(0, self::MESSAGE_RENAME_FAIL); goto oB4Wn; rEP2W: $this->sub->setCriteria("\x6c\x69\156\153", "\x25\57{$oldFilename}", "\114\111\x4b\105"); goto XFQk7; jB3R4: nsD1G: goto j9V1X; NGve3: qZnko: goto vETLX; XFQk7: $this->sub->update(array("\x6c\x69\x6e\153" => BASE_URL . "\165\x70\x6c\157\x61\x64\163\x2f\163\x75\142\164\x69\164\154\145\163\x2f" . $this->data["\156\x61\x6d\145"], "\x75\160\x64\141\x74\145\x64" => time())); goto jPR6m; bH6VH: $newFile = SUBTITLES_PATH . $this->data["\x6e\141\x6d\x65"]; goto HXZGk; B6U8M: goto LYYFD; goto WIqHF; fO0Kp: $oldFilename = basename($getSub["\x66\x69\x6c\145\x5f\x6e\141\x6d\x65"]); goto XvGpL; vETLX: iG_xm: goto AZsGh; uCJeW: if (!$renamed) { goto nsD1G; } goto T6RZP; oB4Wn: $renamed = @rename($oldFile, $newFile); goto uCJeW; AZsGh: return $result; goto P1gCj; gdMNO: if (!$getSub) { goto qZnko; } goto fO0Kp; ZY7s6: $this->subMan->update(array("\x66\151\x6c\145\x5f\x6e\x61\x6d\145" => $this->data["\x6e\x61\x6d\145"], "\165\x70\x64\141\x74\145\x64" => time())); goto rEP2W; hR5v3: $getSub = $this->subMan->getOne(["\x66\151\154\145\137\x6e\141\155\145"]); goto gdMNO; P1gCj: } protected function uploadSubtitle() { goto UWyy4; StFpw: if (!$uploaded) { goto HFPm7; } goto Q8MQa; hwpuV: $inserted = $this->subMan->insert(array("\x66\151\154\x65\137\156\x61\155\x65" => basename($file), "\x66\x69\154\145\137\x73\151\172\145" => filesize($file), "\146\151\x6c\x65\x5f\x74\171\x70\145" => $fileType, "\x6c\141\156\147\165\141\x67\x65" => $lang, "\x61\144\144\x65\x64" => $time, "\x75\x70\144\x61\164\x65\x64" => $time, "\165\x69\144" => $this->currentUser["\x69\x64"], "\150\x6f\163\x74" => BASE_URL)); goto Fp_9U; MsGWo: xrbWU: goto OufOq; IKadJ: $lang = !empty($this->data["\165\x70\154\157\141\x64\x53\x75\142\114\141\x6e\147"]) ? $this->data["\165\x70\x6c\x6f\x61\144\123\x75\142\x4c\141\156\147"] : "\104\145\146\x61\165\154\x74"; goto UeG1Z; VIm5f: $result = $this->toJson(0, self::MESSAGE_FILE_UPLOAD_FAIL, []); goto IKadJ; nHttH: $time = time(); goto hwpuV; zDXmW: $result = $this->toJson(1, self::MESSAGE_FILE_UPLOAD_SUCCESS, ["\x6c\x61\156\147" => $lang, "\x73\165\142" => $uploaded]); goto l_03s; W0PAJ: $fileType = getMimeType($file); goto nHttH; Fp_9U: if (!$inserted) { goto q3nkn; } goto zDXmW; UeG1Z: if (empty($this->files["\x75\160\154\x6f\141\x64\x53\165\142\106\151\x6c\145"])) { goto xrbWU; } goto DbXq5; OufOq: return $result; goto E4ICv; l_03s: q3nkn: goto PyfyM; DbXq5: $uploaded = uploadSubtitle($this->files["\165\x70\x6c\157\141\144\x53\165\x62\x46\x69\x6c\x65"]); goto StFpw; UWyy4: session_write_close(); goto VIm5f; Q8MQa: $file = normalizeSeparator(strtr($uploaded, [BASE_URL => BASE_DIR])); goto W0PAJ; PyfyM: HFPm7: goto MsGWo; E4ICv: } protected function migrate() { goto ZhGvz; ZhGvz: session_write_close(); goto HyFIc; qmXhy: return $result; goto Gx28K; trma7: i8J2J: goto ZRdY6; XryLA: goto nmIWW; goto pdNrt; ZRdY6: PZ07I: goto hg5Y7; SCJeP: if (empty($this->data["\x6f\x6c\144\x4c\x6f\x63\141\164\151\x6f\156"])) { goto YOeqr; } goto n299j; xpkdE: if ($this->isAdmin) { goto naPVy; } goto XryLA; q_1ma: $time = time(); goto HPHH1; JBcb0: if (!$list) { goto PZ07I; } goto q_1ma; HyFIc: $result = $this->notAuthorize(); goto SCJeP; sa9q0: if (!$updated) { goto KVVLJ; } goto Cx5lv; Uh0fd: goto nmIWW; goto iPPG0; hg5Y7: $this->subMan->setCriteria("\150\x6f\x73\x74", $this->data["\x6f\154\x64\x4c\x6f\x63\x61\x74\151\x6f\156"]); goto Bfwoj; ZQv4F: $this->sub->setCriteria("\154\x69\156\x6b", "\x25{$this->data["\x6f\154\x64\114\x6f\x63\x61\164\x69\157\156"]}\45", "\114\111\113\105"); goto fdNDg; iPPG0: FuK3j: goto SohIR; HPHH1: foreach ($list as $dt) { goto qtqfQ; qtqfQ: $link = strtr($dt["\x6c\x69\x6e\x6b"], [$this->data["\x6f\x6c\x64\x4c\157\143\141\164\x69\x6f\156"] => $newLocation]); goto jZTJ3; kuK02: $this->sub->update(["\x6c\x69\156\153" => $link, "\165\160\144\141\164\x65\144" => $time]); goto EXw7N; EXw7N: tVclk: goto mH4F6; jZTJ3: $this->sub->setCriteria("\151\144", $dt["\x69\144"]); goto kuK02; mH4F6: } goto trma7; fdNDg: $list = $this->sub->get(["\x69\144", "\154\151\x6e\x6b"]); goto JBcb0; t389y: goto nmIWW; goto Ym0Po; MmtYk: $newLocation = trim(sanitizeUrl($this->data["\x6e\145\167\x4c\157\143\x61\164\x69\157\156"]), SLASH) . SLASH; goto ZQv4F; Cx5lv: $result = $this->toJson(1, self::MESSAGE_MIGRATE_SUCCESS); goto jTjGm; SohIR: $result = $this->toJson(0, self::MESSAGE_NEW_LOCATION_INVALID); goto t389y; ZZ73e: nmIWW: goto qmXhy; pdNrt: YOeqr: goto t71jt; jTjGm: KVVLJ: goto ZZ73e; n299j: if (empty($this->data["\x6e\145\167\x4c\157\x63\141\164\151\x6f\156"]) || !validateUrl($this->data["\x6e\x65\167\114\157\143\x61\164\x69\x6f\x6e"])) { goto FuK3j; } goto xpkdE; fXUYO: $result = $this->toJson(0, self::MESSAGE_MIGRATE_FAIL); goto MmtYk; Bfwoj: $updated = $this->subMan->update(array("\x68\x6f\163\164" => $newLocation)); goto sa9q0; t71jt: $result = $this->toJson(0, self::MESSAGE_OLD_LOCATION_EMPTY); goto Uh0fd; Ym0Po: naPVy: goto fXUYO; Gx28K: } protected function getHosts() { goto QEMLc; dWZ6Q: return $result; goto mN8TI; Mwur2: $list = $this->subMan->get(["\150\x6f\x73\164"]); goto LzBgP; ZBSho: $this->subMan->setOrderBy("\x68\157\x73\x74"); goto Mwur2; n8JLL: rnljO: goto dWZ6Q; a83sI: $list = []; goto n4x_a; pA0dX: hrJWU: goto grb6F; GZ9_y: $list = array_values(array_filter(array_unique(array_column($list, "\150\157\x73\164")))); goto pA0dX; LJ7lY: $this->subMan->setGroupBy(["\150\157\163\x74"]); goto ZBSho; eQs_q: if (!$this->isAdmin) { goto rnljO; } goto LJ7lY; n4x_a: $result = $this->toJson(0, self::MESSAGE_UNAUTHORIZE, $list); goto eQs_q; grb6F: $result = $this->toJson(1, "\x4f\x4b", $list); goto n8JLL; LzBgP: if (!$list) { goto hrJWU; } goto GZ9_y; QEMLc: session_write_close(); goto a83sI; mN8TI: } protected function delete() { goto JiPSj; wl_IH: XMXL2: goto IgdOt; HsW7z: $deleted[] = @unlink(BASE_DIR . "\163\165\x62\164\151\x74\x6c\x65\163\57" . $getSub["\x66\x69\x6c\x65\x5f\156\141\x6d\x65"]); goto LL_1P; vqIyh: $result = $this->toJson(0, self::MESSAGE_DELETE_FAIL); goto C04vX; LL_1P: $deleted[] = @unlink(SUBTITLES_PATH . $getSub["\x66\151\154\x65\137\156\141\x6d\x65"]); goto Yv58o; c0NmZ: if (!in_array(true, $deleted)) { goto A5Lgg; } goto hZEiW; Xg84I: if (!$getSub) { goto XMXL2; } goto HsW7z; JiPSj: session_write_close(); goto vqIyh; ZWcrZ: $deleted[] = $this->subMan->delete(); goto aNDys; hZEiW: $result = $this->toJson(1, self::MESSAGE_DELETE_SUCCESS); goto b4W0P; C04vX: if (empty($this->data["\151\x64"])) { goto YuCbl; } goto cHvS3; ozS8O: $this->sub->setMultiCriteria([["\x6c\151\156\153", $link, "\x3d"], ["\x6c\x69\156\153", $link2, "\x3d", "\117\122"]]); goto YsCZa; FQ_xn: $getSub = $this->subMan->getOne(["\x68\x6f\x73\x74", "\146\151\x6c\x65\x5f\x6e\x61\x6d\145"]); goto Xg84I; N_mX2: $link2 = $getSub["\150\157\163\x74"] . "\x75\x70\x6c\x6f\141\x64\163\x2f\163\165\142\164\151\164\x6c\x65\163\x2f" . $getSub["\146\x69\154\145\137\156\x61\x6d\x65"]; goto ozS8O; BFMFK: return $result; goto QYvrB; cHvS3: $result = $this->toJson(0, self::MESSAGE_NOT_FOUND); goto y1RgP; y1RgP: $this->tableValidation($this->data["\151\144"], "\x69\144", $this->subMan); goto FQ_xn; Yv58o: $this->subMan->setCriteria("\151\144", $this->data["\x69\x64"]); goto ZWcrZ; IgdOt: YuCbl: goto BFMFK; aNDys: $link = $getSub["\150\157\x73\x74"] . "\x73\x75\x62\x74\x69\x74\x6c\145\163\57" . $getSub["\x66\x69\x6c\145\x5f\156\141\x6d\145"]; goto N_mX2; b4W0P: A5Lgg: goto wl_IH; YsCZa: $deleted[] = $this->sub->delete(); goto c0NmZ; QYvrB: } }
